<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>성경고사</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 800px; margin: auto; padding: 20px; }
  button { margin: 5px; }
  #home-btn { position: fixed; top: 10px; right: 10px; }
  .hidden { display: none; }
</style>
</head>
<body>

<h1 id="title">성경고사</h1>

<div id="home-btn-container">
  <button id="home-btn" class="hidden">🏠 홈</button>
</div>

<div id="menu">
  <button id="practice-btn">연습문제</button>
  <button id="mock-btn">모의고사</button>
</div>

<div id="quiz-container" class="hidden">
  <div id="question-number"></div>
  <div id="question-text"></div>
  <div id="choices"></div>
  <button id="prev-btn">이전 문제</button>
  <button id="next-btn">다음 문제</button>
  <button id="submit-btn" class="hidden">제출</button>
</div>

<div id="result" class="hidden"></div>

<script>
let questions = [];
let currentIndex = 0;
let userAnswers = [];
let totalQuestions = 10; // 모의고사 선택 시 제한 문제 수

// 문제 불러오기
async function loadQuestions() {
  try {
    const res = await fetch('questions/1.txt'); // 텍스트 파일 경로
    if (!res.ok) throw new Error('문제를 불러오지 못했습니다.');
    const text = await res.text();
    questions = parseQuestions(text);
  } catch (err) {
    alert(err.message);
  }
}

// 텍스트 -> 문제 객체
function parseQuestions(text) {
  const lines = text.split('\n').filter(l => l.trim() !== '');
  const result = [];
  let current = null;
  for (const line of lines) {
    if (/^\d+\.\s/.test(line)) {
      if (current) result.push(current);
      current = { text: line.replace(/^\d+\.\s/, ''), choices: [], answer: null };
    } else if (/^\d번:/.test(line)) {
      current.choices.push(line.replace(/^\d번:\s*/, ''));
    } else if (/^답:/.test(line)) {
      current.answer = line.replace(/^답:\s*/, '');
    }
  }
  if (current) result.push(current);
  return result;
}

// 문제 화면 표시
function showQuestion() {
  if (questions.length === 0) return;
  const q = questions[currentIndex];
  document.getElementById('question-number').textContent = `${currentIndex+1} / ${questions.length}`;
  document.getElementById('question-text').textContent = q.text;

  const choicesDiv = document.getElementById('choices');
  choicesDiv.innerHTML = '';
  q.choices.forEach((choice, i) => {
    const btn = document.createElement('button');
    btn.textContent = `${i+1}. ${choice}`;
    btn.style.background = userAnswers[currentIndex] == i+1 ? 'lightgreen' : '';
    btn.onclick = () => {
      userAnswers[currentIndex] = i+1;
      showQuestion();
    };
    choicesDiv.appendChild(btn);
  });
}

// 버튼 이벤트
document.getElementById('practice-btn').onclick = async () => {
  await loadQuestions();
  totalQuestions = questions.length;
  userAnswers = Array(totalQuestions).fill(null);
  currentIndex = 0;
  document.getElementById('menu').classList.add('hidden');
  document.getElementById('quiz-container').classList.remove('hidden');
  document.getElementById('home-btn').classList.remove('hidden');
  document.getElementById('submit-btn').classList.add('hidden'); // 연습문제는 제출 없음
  showQuestion();
};

document.getElementById('mock-btn').onclick = async () => {
  await loadQuestions();
  totalQuestions = Math.min(60, questions.length); // 모의고사 문제 수 제한
  questions = questions.slice(0, totalQuestions);
  userAnswers = Array(totalQuestions).fill(null);
  currentIndex = 0;
  document.getElementById('menu').classList.add('hidden');
  document.getElementById('quiz-container').classList.remove('hidden');
  document.getElementById('home-btn').classList.remove('hidden');
  document.getElementById('submit-btn').classList.remove('hidden'); // 모의고사는 제출
  showQuestion();
};

document.getElementById('prev-btn').onclick = () => {
  if (currentIndex > 0) {
    currentIndex--;
    showQuestion();
  }
};

document.getElementById('next-btn').onclick = () => {
  if (currentIndex < questions.length - 1) {
    currentIndex++;
    showQuestion();
  }
};

document.getElementById('home-btn').onclick = () => {
  document.getElementById('menu').classList.remove('hidden');
  document.getElementById('quiz-container').classList.add('hidden');
  document.getElementById('result').classList.add('hidden');
  document.getElementById('home-btn').classList.add('hidden');
};

document.getElementById('submit-btn').onclick = () => {
  let correct = 0;
  questions.forEach((q, i) => {
    if (userAnswers[i] == parseInt(q.answer)) correct++;
  });
  document.getElementById('result').innerHTML = `총 ${questions.length}문제 중 ${correct}문제 맞았습니다.`;
  document.getElementById('result').classList.remove('hidden');
};
</script>

</body>
</html>
