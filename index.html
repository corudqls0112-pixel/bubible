<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>성경고사 앱</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  .hidden { display: none; }
  button { margin: 5px 0; padding: 10px 20px; }
</style>
</head>
<body>

<h1>성경고사</h1>

<div id="modeSelection">
  <button onclick="startPractice()">연습문제</button>
  <button onclick="startExam()">모의고사</button>
</div>

<div id="quiz" class="hidden">
  <p id="timer" class="hidden"></p>
  <p id="questionText"></p>
  <div id="options"></div>
  <button id="nextBtn" class="hidden" onclick="nextQuestion()">다음 문제</button>
  <button id="submitBtn" class="hidden" onclick="submitExam()">제출</button>
</div>

<div id="result" class="hidden">
  <h2>결과</h2>
  <p id="scoreText"></p>
  <ul id="wrongAnswers"></ul>
  <button onclick="location.reload()">처음으로</button>
</div>

<script>
let questions = [];
let currentIndex = 0;
let isPractice = true;
let totalQuestions = 10;
let timer;
let timeLeft = 50 * 60; // 50분 모의고사

// ------------------ 문제 불러오기 ------------------
async function loadQuestions() {
    const files = Array.from({length: 56}, (_, i) => i+1); // 1~56번 파일
    const loaded = [];
    for (const num of files) {
        try {
            const res = await fetch(`questions/${num}.txt`);
            if(res.ok) loaded.push(parseQuestion(await res.text()));
        } catch (err) {
            console.error("문제 불러오기 실패:", err);
        }
    }
    questions = shuffle(loaded).slice(0, totalQuestions);
}

function parseQuestion(text){
    const lines = text.trim().split("\n");
    const questionLine = lines[0];
    const options = lines.slice(1,5).map(l=>l.replace(/^\d번:\s*/, ''));
    const answer = parseInt(lines[5].replace(/답:\s*/, '')) - 1;
    return {question: questionLine, options, answer, userAnswer: null};
}

function shuffle(array){
    return array.sort(()=>Math.random()-0.5);
}

// ------------------ 시작 ------------------
async function startPractice(){
    isPractice = true;
    await loadQuestions();
    document.getElementById("modeSelection").classList.add("hidden");
    document.getElementById("quiz").classList.remove("hidden");
    currentIndex = 0;
    showQuestion(currentIndex);
}

async function startExam(){
    isPractice = false;
    await loadQuestions();
    document.getElementById("modeSelection").classList.add("hidden");
    document.getElementById("quiz").classList.remove("hidden");
    document.getElementById("timer").classList.remove("hidden");
    startTimer();
    currentIndex = 0;
    showQuestion(currentIndex);
}

// ------------------ 문제 표시 ------------------
function showQuestion(index){
    const q = questions[index];
    document.getElementById("questionText").innerText = q.question;
    const optionsDiv = document.getElementById("options");
    optionsDiv.innerHTML = "";
    q.options.forEach((opt,i)=>{
        const btn = document.createElement("button");
        btn.innerText = opt;
        btn.onclick = ()=>selectAnswer(i);
        optionsDiv.appendChild(btn);
    });

    // 버튼 처리
    if(isPractice){
        document.getElementById("nextBtn").style.display = "none";
        document.getElementById("submitBtn").style.display = "none";
    } else {
        document.getElementById("nextBtn").style.display = "none";
        document.getElementById("submitBtn").style.display = index === questions.length-1 ? "inline-block" : "none";
    }
}

// ------------------ 답 선택 ------------------
function selectAnswer(selected){
    const q = questions[currentIndex];
    q.userAnswer = selected;

    if(isPractice){
        document.getElementById("nextBtn").style.display = "inline-block";
    } else {
        currentIndex++;
        if(currentIndex < questions.length){
            showQuestion(currentIndex);
        } else {
            // 마지막 문제는 제출 버튼 보여짐
            document.getElementById("submitBtn").style.display = "inline-block";
        }
    }
}

// ------------------ 다음 문제 ------------------
function nextQuestion(){
    currentIndex++;
    if(currentIndex < questions.length){
        showQuestion(currentIndex);
    }
}

// ------------------ 모의고사 제출 ------------------
function submitExam(){
    clearInterval(timer);
    document.getElementById("quiz").classList.add("hidden");
    document.getElementById("result").classList.remove("hidden");

    let score = 0;
    const wrongList = document.getElementById("wrongAnswers");
    wrongList.innerHTML = "";

    questions.forEach((q,i)=>{
        if(q.userAnswer === q.answer) score++;
        else {
            const li = document.createElement("li");
            li.innerText = `문제 ${i+1}: ${q.question} → 정답: ${q.options[q.answer]}`;
            wrongList.appendChild(li);
        }
    });

    document.getElementById("scoreText").innerText = `점수: ${Math.round(score/questions.length*100)}점`;
}

// ------------------ 타이머 ------------------
function startTimer(){
    const timerDiv = document.getElementById("timer");
    timerDiv.innerText = formatTime(timeLeft);
    timer = setInterval(()=>{
        timeLeft--;
        timerDiv.innerText = formatTime(timeLeft);
        if(timeLeft <= 0){
            clearInterval(timer);
            submitExam();
        }
    },1000);
}

function formatTime(sec){
    const m = Math.floor(sec/60);
    const s = sec % 60;
    return `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
}

</script>
</body>
</html>
