<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë°±ì„ëŒ€ ì¡¸ì—…ê³ ì‚¬ ëŒ€ë¹„</title>
<style>
  body {
    font-family: 'Arial', sans-serif;
    background: #e6f0ff;
    margin: 0;
    padding: 20px;
    text-align: center;
  }
  h1 { color: #003399; font-size: 1.8em; }
  button {
    margin: 5px;
    padding: 10px 15px;
    border: none;
    border-radius: 10px;
    background-color: #3366cc;
    color: white;
    cursor: pointer;
  }
  button:hover { background-color: #264d99; }
  #container { max-width: 500px; margin: 0 auto; }
  .option-btn {
    display: block;
    width: 100%;
    margin: 5px 0;
    background: white;
    color: #003366;
    border: 1px solid #003366;
  }
  #timer { font-weight: bold; color: red; margin: 10px; }
  #result { margin-top: 15px; text-align: left; }
  @media (max-width: 600px) {
    body { padding: 10px; }
    button { width: 100%; }
  }
</style>
</head>
<body>
  <div id="home">
    <h1>ğŸ“– ë°±ì„ëŒ€ ì¡¸ì—…ê³ ì‚¬</h1>
    <button onclick="startPractice()">ì—°ìŠµë¬¸ì œ</button>
    <button onclick="startExam()">ëª¨ì˜ê³ ì‚¬</button>
  </div>

  <div id="rangeSelect" style="display:none;">
    <h2>ğŸ“š ë²”ìœ„ë¥¼ ì„ íƒí•˜ì„¸ìš”</h2>
    <div id="rangeButtons"></div>
    <button onclick="goHome()">ğŸ  í™ˆìœ¼ë¡œ</button>
  </div>

  <div id="quiz" style="display:none;">
    <div id="timer"></div>
    <div id="question"></div>
    <div id="options"></div>
    <div id="result"></div>
    <button id="prevBtn" onclick="prevQuestion()">â¬… ì´ì „ ë¬¸ì œ</button>
    <button id="nextBtn" onclick="nextQuestion()">â¡ ë‹¤ìŒ ë¬¸ì œ</button>
    <button onclick="submitExam()" id="submitBtn" style="display:none;">ì œì¶œí•˜ê¸°</button>
    <button onclick="goHome()">ğŸ  í™ˆìœ¼ë¡œ</button>
  </div>

  <script>
  let mode = "";
  let questions = [];
  let currentIndex = 0;
  let score = 0;
  let answers = [];
  let timer;
  const totalExamQuestions = 50;
  const examTime = 50 * 60; // 50ë¶„

  const rangeFiles = {
    "ê³ ë¦°ë„ì „ì„œ": "1.txt",
    "ê³ ë¦°ë„í›„ì„œ": "2.txt",
    "ê°ˆë¼ë””ì•„ì„œ": "3.txt",
    "ì—ë² ì†Œì„œ": "4.txt",
    "ë¹Œë¦½ë³´ì„œ": "5.txt",
    "ê³¨ë¡œìƒˆì„œ": "6.txt",
    "ë°ì‚´ë¡œë‹ˆê°€ì „ì„œ": "7.txt",
    "ë°ì‚´ë¡œë‹ˆê°€í›„ì„œ": "8.txt",
    "ë””ëª¨ë°ì „ì„œ": "9.txt",
    "ë””ëª¨ë°í›„ì„œ": "10.txt",
    "ë””ë„ì„œ": "11.txt",
    "ë¹Œë ˆëª¬ì„œ": "12.txt",
    "íˆë¸Œë¦¬ì„œ": "13.txt",
    "ì•¼ê³ ë³´ì„œ": "14.txt",
    "ë² ë“œë¡œì „ì„œ": "15.txt",
    "ë² ë“œë¡œí›„ì„œ": "16.txt",
    "ìš”í•œì¼ì„œ": "17.txt",
    "ìš”í•œì´ì„œ": "18.txt",
    "ìš”í•œì‚¼ì„œ": "19.txt",
    "ìœ ë‹¤ì„œ": "20.txt",
    "ìš”í•œê³„ì‹œë¡": "21.txt"
  };

  function goHome(){
    document.getElementById("home").style.display = "block";
    document.getElementById("rangeSelect").style.display = "none";
    document.getElementById("quiz").style.display = "none";
    clearInterval(timer);
  }

  function startPractice(){
    mode = "practice";
    document.getElementById("home").style.display = "none";
    document.getElementById("rangeSelect").style.display = "block";
    const container = document.getElementById("rangeButtons");
    container.innerHTML = "";
    for (let name in rangeFiles) {
      const btn = document.createElement("button");
      btn.textContent = name;
      btn.onclick = ()=>loadQuestions(rangeFiles[name]);
      container.appendChild(btn);
    }
  }

  async function startExam(){
    mode = "exam";
    document.getElementById("home").style.display = "none";
    document.getElementById("quiz").style.display = "block";
    questions = [];
    const keys = Object.keys(rangeFiles);
    for (let key of keys){
      const res = await fetch(`questions/${rangeFiles[key]}`);
      if(res.ok){
        const text = await res.text();
        const allQs = parseQuestions(text);
        questions.push(...shuffle(allQs).slice(0,3)); // ê° ë²”ìœ„ì—ì„œ 3ë¬¸ì œì”©
      }
    }
    questions = shuffle(questions).slice(0, totalExamQuestions);
    answers = new Array(questions.length).fill(null);
    currentIndex = 0;
    score = 0;
    showQuestion();
    document.getElementById("submitBtn").style.display = "block";
    startTimer(examTime);
  }

  async function loadQuestions(file){
    const res = await fetch(`questions/${file}`);
    const text = await res.text();
    questions = parseQuestions(text);
    // âœ… ìˆ˜ì •: 10ë¬¸ì œ ì œí•œ ì œê±° â†’ ëª¨ë“  ë¬¸ì œ í‘œì‹œ
    answers = new Array(questions.length).fill(null);
    document.getElementById("rangeSelect").style.display = "none";
    document.getElementById("quiz").style.display = "block";
    document.getElementById("submitBtn").style.display = "none";
    currentIndex = 0;
    showQuestion();
  }

  function parseQuestions(text){
    const lines = text.split("\n").map(l=>l.trim()).filter(Boolean);
    const qs = [];
    let current = {};
    lines.forEach(line=>{
      if(line.startsWith("ë‹µ:")){
        current.answer = parseInt(line.replace("ë‹µ:","").trim())-1;
        qs.push(current);
        current = {};
      } else if(!current.question){
        current.question = line;
        current.options = [];
      } else {
        current.options.push(line.replace(/^\dë²ˆ:\s*/,""));
      }
    });
    return qs;
  }

  function showQuestion(){
    const q = questions[currentIndex];
    document.getElementById("question").innerText = `(${currentIndex+1}/${questions.length}) ${q.question}`;
    const optionsDiv = document.getElementById("options");
    optionsDiv.innerHTML = "";
    q.options.forEach((opt,i)=>{
      const btn = document.createElement("button");
      btn.className = "option-btn";
      btn.innerText = opt;
      btn.onclick = ()=>selectAnswer(i);
      optionsDiv.appendChild(btn);
    });
    document.getElementById("result").innerText = "";
  }

  function selectAnswer(i){
    const q = questions[currentIndex];
    answers[currentIndex] = i;
    if(mode === "practice"){
      const resultDiv = document.getElementById("result");
      if(i === q.answer){
        resultDiv.innerHTML = "âœ… ì •ë‹µì…ë‹ˆë‹¤!";
      } else {
        resultDiv.innerHTML = `âŒ ì˜¤ë‹µì…ë‹ˆë‹¤.<br>ì •ë‹µ: ${q.options[q.answer]}`;
      }
    } else if(mode === "exam"){
      nextQuestion();
    }
  }

  function nextQuestion(){
    if(currentIndex < questions.length - 1){
      currentIndex++;
      showQuestion();
    }
  }

  function prevQuestion(){
    if(currentIndex > 0){
      currentIndex--;
      showQuestion();
    }
  }

  // --- ëª¨ì˜ê³ ì‚¬ ê²°ê³¼ í‘œì‹œ í™•ì¥ ---
function submitMockExam() {
  clearInterval(timerInterval);
  let correct = 0;
  const resultDiv = document.getElementById("result");
  resultDiv.innerHTML = `<h3>ê²°ê³¼</h3>`;

  questions.forEach((q, i) => {
    const userAns = userAnswers[i];
    const isCorrect = userAns === q.answer;
    if (isCorrect) correct++;

    const userChoice = userAns !== null ? q.options[userAns] : "(ë¬´ì‘ë‹µ)";
    const correctChoice = q.options[q.answer];

    // ğŸ”¹ ê° ë¬¸í•­ë³„ ê²°ê³¼ í‘œì‹œ
    const questionResult = document.createElement("div");
    questionResult.classList.add("question-result");
    questionResult.style.marginBottom = "12px";
    questionResult.style.padding = "8px";
    questionResult.style.border = "1px solid #ccc";
    questionResult.style.borderRadius = "8px";
    questionResult.style.backgroundColor = isCorrect ? "#e8ffe8" : "#ffe8e8";

    questionResult.innerHTML = `
      <strong>(${i + 1}) ${q.question}</strong><br>
      <span>ë‚´ê°€ ì„ íƒí•œ ë‹µ: ${userChoice}</span><br>
      <span>ì •ë‹µ: ${correctChoice}</span><br>
      <span style="font-weight:bold; color:${isCorrect ? 'green' : 'red'};">
        ${isCorrect ? 'ì •ë‹µ âœ…' : 'ì˜¤ë‹µ âŒ'}
      </span>
    `;

    resultDiv.appendChild(questionResult);
  });

  // ğŸ”¹ ì´ì  í‘œì‹œ
  const totalScore = document.createElement("h4");
  totalScore.innerText = `ì´ì : ${correct}/${questions.length}`;
  totalScore.style.textAlign = "center";
  totalScore.style.marginTop = "20px";
  resultDiv.prepend(totalScore);

  // ğŸ”¹ ë‹¤ì‹œí•˜ê¸° ë²„íŠ¼
  const retryBtn = document.createElement("button");
  retryBtn.innerText = "ë‹¤ì‹œí•˜ê¸°";
  retryBtn.onclick = () => location.reload();
  retryBtn.style.display = "block";
  retryBtn.style.margin = "20px auto";
  retryBtn.style.padding = "10px 20px";
  retryBtn.style.fontSize = "16px";
  retryBtn.style.borderRadius = "8px";
  retryBtn.style.backgroundColor = "#4CAF50";
  retryBtn.style.color = "white";
  resultDiv.appendChild(retryBtn);
}
  function startTimer(seconds){
    const timerDiv = document.getElementById("timer");
    let remaining = seconds;
    timer = setInterval(()=>{
      const min = Math.floor(remaining/60);
      const sec = remaining%60;
      timerDiv.textContent = `â± ë‚¨ì€ ì‹œê°„: ${min}:${sec.toString().padStart(2,"0")}`;
      if(remaining <= 0){
        clearInterval(timer);
        alert("ì‹œê°„ ì¢…ë£Œ! ìë™ ì œì¶œë©ë‹ˆë‹¤.");
        submitExam();
      }
      remaining--;
    },1000);
  }
  </script>
</body>
</html>
