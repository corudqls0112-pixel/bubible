<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>성경고사 문제은행</title>
<style>
body {
  font-family: 'Pretendard', sans-serif;
  background: #f8fafc;
  margin: 0; padding: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
}
header {
  background: #2563eb;
  color: white;
  width: 100%;
  padding: 15px 0;
  text-align: center;
  font-size: 22px;
  font-weight: bold;
  position: relative;
}
#homeBtn {
  position: absolute;
  left: 15px;
  top: 15px;
  background: #1e40af;
  border: none;
  color: white;
  padding: 6px 12px;
  border-radius: 8px;
  cursor: pointer;
}
main {
  width: 95%;
  max-width: 700px;
  background: white;
  margin-top: 20px;
  border-radius: 12px;
  padding: 20px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}
button {
  background: #2563eb;
  color: white;
  border: none;
  padding: 12px 20px;
  border-radius: 8px;
  font-size: 16px;
  margin: 8px;
  cursor: pointer;
  width: 90%;
  max-width: 320px;
}
button:hover { background: #1e40af; }
#options button {
  display: block;
  width: 100%;
  margin-top: 8px;
  text-align: left;
}
.hidden { display: none; }
#result div {
  border-bottom: 1px solid #e2e8f0;
  padding: 8px 0;
}
.question-result {
  margin-bottom: 10px;
  padding: 8px;
  border-radius: 8px;
}
@media (max-width: 600px) {
  main { padding: 15px; font-size: 15px; }
  button { font-size: 15px; }
}
</style>
</head>
<body>

<header>
  📖 성경고사 문제은행
  <button id="homeBtn" onclick="goHome()">🏠 홈</button>
</header>

<main>
  <div id="menu">
    <button onclick="startPracticeMode()">연습 모드</button>
    <button onclick="startMockExam()">모의고사</button>
  </div>

  <div id="rangeSelect" class="hidden">
    <h3>📚 범위 선택</h3>
    <div id="rangeButtons"></div>
  </div>

  <div id="quiz" class="hidden">
    <div id="timer" style="text-align:right; font-weight:bold;"></div>
    <div id="question" style="margin:20px 0; font-weight:bold;"></div>
    <div id="options"></div>
    <div style="text-align:center; margin-top:20px;">
      <button id="prevBtn" onclick="prevQuestion()">이전</button>
      <button id="nextBtn" onclick="nextQuestion()">다음</button>
      <button id="submitBtn" class="hidden" onclick="submitMockExam()">제출</button>
    </div>
  </div>

  <div id="result" class="hidden"></div>
</main>

<script>
const bookFiles = {
  "고린도전서":"1.txt","고린도후서":"2.txt","갈라디아서":"3.txt","에베소서":"4.txt","빌립보서":"5.txt",
  "골로새서":"6.txt","데살로니가전서":"7.txt","데살로니가후서":"8.txt","디모데전서":"9.txt","디모데후서":"10.txt",
  "디도서":"11.txt","빌레몬서":"12.txt","히브리서":"13.txt","야고보서":"14.txt","베드로전서":"15.txt",
  "베드로후서":"16.txt","요한일서":"17.txt","요한이서":"18.txt","요한삼서":"19.txt","유다서":"20.txt","요한계시록":"21.txt"
};

let mode="", questions=[], currentIndex=0, userAnswers=[], timerInterval=0;

// 홈 버튼
function goHome(){
  clearInterval(timerInterval);
  mode=""; questions=[]; currentIndex=0; userAnswers=[];
  document.getElementById("menu").classList.remove("hidden");
  document.getElementById("rangeSelect").classList.add("hidden");
  document.getElementById("quiz").classList.add("hidden");
  document.getElementById("result").classList.add("hidden");
}

// ✅ 문제 파싱
function parseQuestions(text){
  const lines = text.split("\n").map(l=>l.trim()).filter(Boolean);
  const qs=[]; let current={};
  lines.forEach(line=>{
    if(line.startsWith("답:")){
      current.answer = parseInt(line.replace("답:","").trim())-1;
      qs.push(current);
      current={};
    } else if(!current.question){
      current.question = line;
      current.options = [];
    } else {
      current.options.push(line.replace(/^\d번:\s*/,""));
    }
  });
  return qs;
}

// 연습모드 시작
function startPracticeMode(){
  mode="practice";
  document.getElementById("menu").classList.add("hidden");
  document.getElementById("rangeSelect").classList.remove("hidden");
  const container=document.getElementById("rangeButtons"); container.innerHTML="";
  Object.keys(bookFiles).forEach(name=>{
    const btn=document.createElement("button");
    btn.textContent=name;
    btn.onclick=()=>loadPracticeQuestions(bookFiles[name]);
    container.appendChild(btn);
  });
}

// 연습모드 문제 불러오기
async function loadPracticeQuestions(file){
  const res=await fetch(file); const text=await res.text();
  questions=parseQuestions(text); // ✅ 모든 문제
  currentIndex=0; userAnswers=new Array(questions.length).fill(null);
  document.getElementById("rangeSelect").classList.add("hidden");
  document.getElementById("quiz").classList.remove("hidden");
  document.getElementById("submitBtn").classList.add("hidden");
  document.getElementById("timer").innerText="";
  showQuestion();
}

// 모의고사 시작
async function startMockExam(){
  mode="mock";
  document.getElementById("menu").classList.add("hidden");
  document.getElementById("quiz").classList.remove("hidden");
  let allQuestions=[];
  for(const file of Object.values(bookFiles)){
    const res=await fetch(file); const text=await res.text();
    const qs=parseQuestions(text);
    allQuestions.push(...qs.sort(()=>0.5-Math.random()).slice(0,3)); // 범위당 3문제
  }
  questions=allQuestions.sort(()=>0.5-Math.random()).slice(0,50);
  userAnswers=new Array(questions.length).fill(null);
  currentIndex=0;
  showQuestion();
  startTimer(50*60);
}

// 타이머
function startTimer(seconds){
  const timerDiv=document.getElementById("timer");
  function update(){
    const m=Math.floor(seconds/60), s=seconds%60;
    timerDiv.textContent=`⏰ 남은 시간: ${m}:${s.toString().padStart(2,"0")}`;
    if(seconds<=0){ clearInterval(timerInterval); submitMockExam(); }
    seconds--;
  }
  update();
  timerInterval=setInterval(update,1000);
}

// 문제 표시
function showQuestion(){
  const q=questions[currentIndex];
  document.getElementById("question").innerText=`(${currentIndex+1}/${questions.length}) ${q.question}`;
  const optionsDiv=document.getElementById("options"); optionsDiv.innerHTML="";
  q.options.forEach((opt,i)=>{
    const btn=document.createElement("button");
    btn.innerText=opt;
    btn.style.background=userAnswers[currentIndex]===i?"#93c5fd":"";
    btn.onclick=()=>{
      if(mode==="practice"){
        const correct=i===q.answer;
        userAnswers[currentIndex]=i;
        alert(correct?`✅ 정답`:`❌ 오답\n정답: ${q.options[q.answer]}`);
      } else { userAnswers[currentIndex]=i; nextQuestion(); }
      showQuestion();
    };
    optionsDiv.appendChild(btn);
  });
  document.getElementById("prevBtn").disabled=currentIndex===0;
  document.getElementById("nextBtn").disabled=currentIndex===questions.length-1;
  if(mode==="mock" && currentIndex===questions.length-1) document.getElementById("submitBtn").classList.remove("hidden");
  else document.getElementById("submitBtn").classList.add("hidden");
}

function nextQuestion(){ if(currentIndex<questions.length-1){ currentIndex++; showQuestion(); } }
function prevQuestion(){ if(currentIndex>0){ currentIndex--; showQuestion(); } }

// 모의고사 결과
function submitMockExam(){
  clearInterval(timerInterval);
  document.getElementById("quiz").classList.add("hidden");
  const resultDiv=document.getElementById("result"); resultDiv.classList.remove("hidden");
  resultDiv.innerHTML=`<h3>📊 결과</h3>`;
  let correct=0;
  questions.forEach((q,i)=>{
    const userAns=userAnswers[i];
    const isCorrect=userAns===q.answer;
    if(isCorrect) correct++;
    const userChoice=userAns!==null?q.options[userAns]:"(무응답)";
    const correctChoice=q.options[q.answer];
    const div=document.createElement("div");
    div.classList.add("question-result");
    div.style.background=isCorrect?"#e6ffed":"#ffe6e6";
    div.innerHTML=`<strong>${i+1}. ${q.question}</strong><br>내 답: ${userChoice}<br>정답: ${correctChoice}<br><b style="color:${isCorrect?'green':'red'}">${isCorrect?'정답 ✅':'오답 ❌'}</b>`;
    resultDiv.appendChild(div);
  });
  const score=document.createElement("h4");
  score.textContent=`총점: ${correct}/${questions.length}`;
  score.style.textAlign="center"; score.style.marginTop="20px";
  resultDiv.prepend(score);
  const retryBtn=document.createElement("button");
  retryBtn.innerText="다시하기"; retryBtn.onclick=()=>location.reload();
  retryBtn.style.display="block"; retryBtn.style.margin="20px auto";
  resultDiv.appendChild(retryBtn);
}
</script>
</body>
</html>
