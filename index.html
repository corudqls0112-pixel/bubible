<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>📖 백석대 졸업고시</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { font-family: 'Noto Sans KR', sans-serif; background-color:#e6f0ff; margin:0; padding:20px; text-align:center;}
  h1 { color:#002366; font-size:2em; margin-bottom:10px;}
  button.option-btn { margin:5px; padding:10px 16px; font-size:1em; border:none; border-radius:10px; cursor:pointer; background-color:#0056d6; color:white; transition:0.3s; }
  button.option-btn.selected { background-color:#003c9d; }
  button { margin:5px; padding:10px 16px; font-size:1em; border:none; border-radius:10px; cursor:pointer; background-color:#0056d6; color:white; transition:0.3s;}
  button:hover { background-color:#003c9d;}
  #question-container { margin-top:20px; padding:20px; background:white; border-radius:15px; box-shadow:0 4px 8px rgba(0,0,0,0.1); display:none; max-width:600px; margin-left:auto; margin-right:auto;}
  .timer { font-size:1.2em; color:#d9534f; font-weight:bold; margin-bottom:10px;}
  #result { margin-top:10px; font-weight:bold; white-space:pre-line; }
  #footer { position:fixed; bottom:0; left:0; width:100%; padding:8px 0; background-color:rgba(0,0,0,0.2); color:#000; font-size:0.9em; text-align:center; z-index:999;}
  @media(max-width:600px){ button{width:80%; margin:5px 0;} }
</style>
</head>
<body>

<h1>📖 백석대 졸업고사</h1>

<div id="home-screen">
  <button id="practice-btn">연습문제 시작</button>
  <button id="mock-btn">모의고사 시작</button>
</div>

<div id="range-selection" style="display:none;">
  <h2>연습문제 범위 선택</h2>
  <div id="range-buttons"></div>
  <button id="range-back">⬅ 뒤로</button>
</div>

<button id="home-btn" style="display:none;">🏠 홈으로</button>

<div id="question-container">
  <div id="timer" class="timer"></div>
  <h2 id="question"></h2>
  <div id="options"></div>
  <button id="prev-btn" style="display:none;">⬅ 이전</button>
  <button id="next-btn" style="display:none;">다음 ➡</button>
  <button id="submit-btn" style="display:none;">제출하기</button>
  <div id="result"></div>
</div>

<div id="footer">📝 81인 교수들이 출제한 백석성경문제집 문제들로만 구성되어 있습니다.</div>

<script>
let questions=[], currentIndex=0, mode='', answers=[], timer, timeLeft=0;

const ranges=[
  {name:"요한계시록", file:"21.txt"} // 테스트용
];

// 버튼 이벤트
document.getElementById("practice-btn").onclick=()=>showRangeSelection();
document.getElementById("mock-btn").onclick=()=>startMode("mock");
document.getElementById("home-btn").onclick=goHome;
document.getElementById("next-btn").onclick=nextQuestion;
document.getElementById("prev-btn").onclick=prevQuestion;
document.getElementById("submit-btn").onclick=showMockResult;
document.getElementById("range-back").onclick=()=>{document.getElementById("range-selection").style.display="none";document.getElementById("home-screen").style.display="block";}

// 범위 선택
function showRangeSelection(){
  document.getElementById("home-screen").style.display="none";
  const container=document.getElementById("range-buttons");
  container.innerHTML="";
  ranges.forEach((r)=>{
    const btn=document.createElement("button");
    btn.innerText=r.name;
    btn.onclick=()=>startMode("practice",r);
    container.appendChild(btn);
  });
  document.getElementById("range-selection").style.display="block";
}

// 시작
async function startMode(selectedMode,range=null){
  mode=selectedMode;
  document.getElementById("home-btn").style.display="block";
  document.getElementById("home-screen").style.display="none";
  document.getElementById("range-selection").style.display="none";
  document.getElementById("question-container").style.display="block";
  answers=[]; currentIndex=0;

  if(mode==="practice" && range){
    questions=await loadQuestions([range.file]);
  } else if(mode==="mock"){
    questions=await loadQuestions(ranges.map(r=>r.file));
    startTimer(3000);
    document.getElementById("submit-btn").style.display="inline";
  }
  showQuestion();
}

// 문제 불러오기
async function loadQuestions(files){
  let loaded=[];
  for(const f of files){
    try{
      const res=await fetch(`questions/${f}`);
      if(res.ok){
        const txt=await res.text();
        loaded.push(...parseQuestions(txt,"요한계시록"));
      }
    }catch(e){console.log(e);}
  }

  // 예시 복수정답 문제 추가
  loaded.push({
    question:"요한계시록 15장에서 짐승과 그의 우상과 그의 이름의 수를 이기고 벗어난 자들이 부르는 노래는?(두 가지)",
    options:["인자의 노래","어린 양의 노래","새 노래","승리의 노래","십사만사천의 노래","모세의 노래"],
    answer:[1,5],
    range:"요한계시록"
  });

  return loaded;
}

// 문제 파싱
function parseQuestions(text,rangeName){
  const lines=text.split("\n").map(l=>l.trim()).filter(Boolean);
  const qs=[]; let current={options:[]};
  lines.forEach(line=>{
    if(line.startsWith("답:")){
      current.answer=line.replace("답:","").split(",").map(x=>parseInt(x.trim())-1);
      current.range=rangeName; qs.push(current); current={options:[]};
    } else if(!current.question){
      current.question=line;
    } else {
      current.options.push(line.replace(/^\d번:\s*/,""));
    }
  });
  return qs;
}

// 문제 표시
function showQuestion(){
  const q=questions[currentIndex];
  q.userSelected=q.userSelected||[];
  document.getElementById("question").innerText=`(${currentIndex+1}) ${q.question}`;
  const optionsDiv=document.getElementById("options");
  optionsDiv.innerHTML="";
  q.options.forEach((opt,i)=>{
    const btn=document.createElement("button");
    btn.innerText=opt;
    btn.className="option-btn";
    if(q.userSelected.includes(i)) btn.classList.add("selected");

    const clickHandler=()=>{
      const idx=q.userSelected.indexOf(i);
      if(idx>=0){ q.userSelected.splice(idx,1); btn.classList.remove("selected"); }
      else { q.userSelected.push(i); btn.classList.add("selected"); }

      if(mode==="practice" && q.userSelected.length===(Array.isArray(q.answer)?q.answer.length:1)){
        setTimeout(()=>checkAnswer(q),50);
      }
      if(mode==="mock" && q.userSelected.length===(Array.isArray(q.answer)?q.answer.length:1)){
        answers[currentIndex]=[...q.userSelected];
        setTimeout(nextQuestion,50);
      }
    };

    btn.addEventListener("click",clickHandler);
    btn.addEventListener("touchstart",clickHandler);
    optionsDiv.appendChild(btn);
  });

  document.getElementById("result").innerText="";
}

// 정답 체크
async function checkAnswer(q){
  await new Promise(r=>setTimeout(r,50)); // 모바일 렌더링 안정화
  const sortedUser=(q.userSelected||[]).sort().toString();
  const sortedAns=q.answer.sort().toString();
  const isCorrect=sortedUser===sortedAns;
  const res=document.getElementById("result");
  if(isCorrect){
    res.innerHTML=`✅ 정답입니다!\n정답: ${q.answer.map(i=>q.options[i]).join(", ")}`;
  } else {
    res.innerHTML=`❌ 오답입니다.\n정답: ${q.answer.map(i=>q.options[i]).join(", ")}`;
  }
}

// 이전/다음
function nextQuestion(){ if(currentIndex<questions.length-1){ currentIndex++; showQuestion(); }}
function prevQuestion(){ if(currentIndex>0){ currentIndex--; showQuestion(); }}

// 모의고사 결과
async function showMockResult(){
  await new Promise(r=>setTimeout(r,100)); // 모바일 안정화
  clearInterval(timer);
  let score=0;
  let html="<h3>결과</h3>";

  questions.forEach((q,i)=>{
    const sortedUser=(q.userSelected||[]).sort().toString();
    const sortedAns=q.answer.sort().toString();
    const isCorrect=sortedUser===sortedAns;
    if(isCorrect) score++;
    html+=`
      <div style="margin-bottom:15px;padding:10px;border-bottom:1px solid #ccc;">
        <p><strong>문제 ${i+1}:</strong> ${q.question}</p>
        <p>선택: ${(q.userSelected&&q.userSelected.map(x=>q.options[x]).join(", "))||"-"} ${isCorrect?"✅":"❌"}</p>
        <p>정답: ${q.answer.map(x=>q.options[x]).join(", ")}</p>
      </div>`;
  });

  html=`<h2>총점: ${Math.round(score/questions.length*100)}점</h2>`+html;
  document.getElementById("question").innerHTML=html;
  document.getElementById("options").innerHTML="";
  document.getElementById("prev-btn").style.display="none";
  document.getElementById("next-btn").style.display="none";
  document.getElementById("submit-btn").style.display="none";
  document.getElementById("timer").innerText="";
}

// 타이머
function startTimer(seconds){
  timeLeft=seconds;
  timer=setInterval(()=>{
    const min=Math.floor(timeLeft/60);
    const sec=timeLeft%60;
    document.getElementById("timer").innerText=`⏰ 남은 시간: ${min}분 ${sec<10?"0"+sec:sec}초`;
    if(timeLeft--<=0){ clearInterval(timer); showMockResult(); }
  },1000);
}

// 홈
function goHome(){
  clearInterval(timer);
  document.getElementById("home-screen").style.display="block";
  document.getElementById("range-selection").style.display="none";
  document.getElementById("question-container").style.display="none";
  document.getElementById("home-btn").style.display="none";
  answers=[]; currentIndex=0; questions=[];
}
</script>
</body>
</html>
