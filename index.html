<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì„±ê²½ê³ ì‚¬ ë¬¸ì œì€í–‰</title>
<style>
body {
  font-family: 'Pretendard', sans-serif;
  background: #f8fafc;
  margin: 0; padding: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
}
header {
  background: #2563eb;
  color: white;
  width: 100%;
  padding: 15px 0;
  text-align: center;
  font-size: 22px;
  font-weight: bold;
  position: relative;
}
#homeBtn {
  position: absolute;
  left: 15px;
  top: 15px;
  background: #1e40af;
  border: none;
  color: white;
  padding: 6px 12px;
  border-radius: 8px;
  cursor: pointer;
}
main {
  width: 95%;
  max-width: 700px;
  background: white;
  margin-top: 20px;
  border-radius: 12px;
  padding: 20px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}
button {
  background: #2563eb;
  color: white;
  border: none;
  padding: 12px 20px;
  border-radius: 8px;
  font-size: 16px;
  margin: 8px;
  cursor: pointer;
  width: 90%;
  max-width: 320px;
}
button:hover { background: #1e40af; }
#options button {
  display: block;
  width: 100%;
  margin-top: 8px;
  text-align: left;
}
.hidden { display: none; }
#result div {
  border-bottom: 1px solid #e2e8f0;
  padding: 8px 0;
}
.question-result {
  margin-bottom: 10px;
  padding: 8px;
  border-radius: 8px;
}
@media (max-width: 600px) {
  main { padding: 15px; font-size: 15px; }
  button { font-size: 15px; }
}
</style>
</head>
<body>

<header>
  ğŸ“– ì„±ê²½ê³ ì‚¬ ë¬¸ì œì€í–‰
  <button id="homeBtn" onclick="goHome()">ğŸ  í™ˆ</button>
</header>

<main>
  <div id="menu">
    <button onclick="startPracticeMode()">ì—°ìŠµ ëª¨ë“œ</button>
    <button onclick="startMockExam()">ëª¨ì˜ê³ ì‚¬</button>
  </div>

  <div id="rangeSelect" class="hidden">
    <h3>ğŸ“š ë²”ìœ„ ì„ íƒ</h3>
    <div id="rangeButtons"></div>
  </div>

  <div id="quiz" class="hidden">
    <div id="timer" style="text-align:right; font-weight:bold;"></div>
    <div id="question" style="margin:20px 0; font-weight:bold;"></div>
    <div id="options"></div>
    <div style="text-align:center; margin-top:20px;">
      <button id="prevBtn" onclick="prevQuestion()">ì´ì „</button>
      <button id="nextBtn" onclick="nextQuestion()">ë‹¤ìŒ</button>
      <button id="submitBtn" class="hidden" onclick="submitMockExam()">ì œì¶œ</button>
    </div>
  </div>

  <div id="result" class="hidden"></div>
</main>

<script>
const bookFiles = {
  "ê³ ë¦°ë„ì „ì„œ":"1.txt","ê³ ë¦°ë„í›„ì„œ":"2.txt","ê°ˆë¼ë””ì•„ì„œ":"3.txt","ì—ë² ì†Œì„œ":"4.txt","ë¹Œë¦½ë³´ì„œ":"5.txt",
  "ê³¨ë¡œìƒˆì„œ":"6.txt","ë°ì‚´ë¡œë‹ˆê°€ì „ì„œ":"7.txt","ë°ì‚´ë¡œë‹ˆê°€í›„ì„œ":"8.txt","ë””ëª¨ë°ì „ì„œ":"9.txt","ë””ëª¨ë°í›„ì„œ":"10.txt",
  "ë””ë„ì„œ":"11.txt","ë¹Œë ˆëª¬ì„œ":"12.txt","íˆë¸Œë¦¬ì„œ":"13.txt","ì•¼ê³ ë³´ì„œ":"14.txt","ë² ë“œë¡œì „ì„œ":"15.txt",
  "ë² ë“œë¡œí›„ì„œ":"16.txt","ìš”í•œì¼ì„œ":"17.txt","ìš”í•œì´ì„œ":"18.txt","ìš”í•œì‚¼ì„œ":"19.txt","ìœ ë‹¤ì„œ":"20.txt","ìš”í•œê³„ì‹œë¡":"21.txt"
};

let mode="", questions=[], currentIndex=0, userAnswers=[], timerInterval=0;

// í™ˆ ë²„íŠ¼
function goHome(){
  clearInterval(timerInterval);
  mode=""; questions=[]; currentIndex=0; userAnswers=[];
  document.getElementById("menu").classList.remove("hidden");
  document.getElementById("rangeSelect").classList.add("hidden");
  document.getElementById("quiz").classList.add("hidden");
  document.getElementById("result").classList.add("hidden");
}

// âœ… ë¬¸ì œ íŒŒì‹±
function parseQuestions(text){
  const lines = text.split("\n").map(l=>l.trim()).filter(Boolean);
  const qs=[]; let current={};
  lines.forEach(line=>{
    if(line.startsWith("ë‹µ:")){
      current.answer = parseInt(line.replace("ë‹µ:","").trim())-1;
      qs.push(current);
      current={};
    } else if(!current.question){
      current.question = line;
      current.options = [];
    } else {
      current.options.push(line.replace(/^\dë²ˆ:\s*/,""));
    }
  });
  return qs;
}

// ì—°ìŠµëª¨ë“œ ì‹œì‘
function startPracticeMode(){
  mode="practice";
  document.getElementById("menu").classList.add("hidden");
  document.getElementById("rangeSelect").classList.remove("hidden");
  const container=document.getElementById("rangeButtons"); container.innerHTML="";
  Object.keys(bookFiles).forEach(name=>{
    const btn=document.createElement("button");
    btn.textContent=name;
    btn.onclick=()=>loadPracticeQuestions(bookFiles[name]);
    container.appendChild(btn);
  });
}

// ì—°ìŠµëª¨ë“œ ë¬¸ì œ ë¶ˆëŸ¬ì˜¤ê¸°
async function loadPracticeQuestions(file){
  const res=await fetch(file); const text=await res.text();
  questions=parseQuestions(text); // âœ… ëª¨ë“  ë¬¸ì œ
  currentIndex=0; userAnswers=new Array(questions.length).fill(null);
  document.getElementById("rangeSelect").classList.add("hidden");
  document.getElementById("quiz").classList.remove("hidden");
  document.getElementById("submitBtn").classList.add("hidden");
  document.getElementById("timer").innerText="";
  showQuestion();
}

// ëª¨ì˜ê³ ì‚¬ ì‹œì‘
async function startMockExam(){
  mode="mock";
  document.getElementById("menu").classList.add("hidden");
  document.getElementById("quiz").classList.remove("hidden");
  let allQuestions=[];
  for(const file of Object.values(bookFiles)){
    const res=await fetch(file); const text=await res.text();
    const qs=parseQuestions(text);
    allQuestions.push(...qs.sort(()=>0.5-Math.random()).slice(0,3)); // ë²”ìœ„ë‹¹ 3ë¬¸ì œ
  }
  questions=allQuestions.sort(()=>0.5-Math.random()).slice(0,50);
  userAnswers=new Array(questions.length).fill(null);
  currentIndex=0;
  showQuestion();
  startTimer(50*60);
}

// íƒ€ì´ë¨¸
function startTimer(seconds){
  const timerDiv=document.getElementById("timer");
  function update(){
    const m=Math.floor(seconds/60), s=seconds%60;
    timerDiv.textContent=`â° ë‚¨ì€ ì‹œê°„: ${m}:${s.toString().padStart(2,"0")}`;
    if(seconds<=0){ clearInterval(timerInterval); submitMockExam(); }
    seconds--;
  }
  update();
  timerInterval=setInterval(update,1000);
}

// ë¬¸ì œ í‘œì‹œ
function showQuestion(){
  const q=questions[currentIndex];
  document.getElementById("question").innerText=`(${currentIndex+1}/${questions.length}) ${q.question}`;
  const optionsDiv=document.getElementById("options"); optionsDiv.innerHTML="";
  q.options.forEach((opt,i)=>{
    const btn=document.createElement("button");
    btn.innerText=opt;
    btn.style.background=userAnswers[currentIndex]===i?"#93c5fd":"";
    btn.onclick=()=>{
      if(mode==="practice"){
        const correct=i===q.answer;
        userAnswers[currentIndex]=i;
        alert(correct?`âœ… ì •ë‹µ`:`âŒ ì˜¤ë‹µ\nì •ë‹µ: ${q.options[q.answer]}`);
      } else { userAnswers[currentIndex]=i; nextQuestion(); }
      showQuestion();
    };
    optionsDiv.appendChild(btn);
  });
  document.getElementById("prevBtn").disabled=currentIndex===0;
  document.getElementById("nextBtn").disabled=currentIndex===questions.length-1;
  if(mode==="mock" && currentIndex===questions.length-1) document.getElementById("submitBtn").classList.remove("hidden");
  else document.getElementById("submitBtn").classList.add("hidden");
}

function nextQuestion(){ if(currentIndex<questions.length-1){ currentIndex++; showQuestion(); } }
function prevQuestion(){ if(currentIndex>0){ currentIndex--; showQuestion(); } }

// ëª¨ì˜ê³ ì‚¬ ê²°ê³¼
function submitMockExam(){
  clearInterval(timerInterval);
  document.getElementById("quiz").classList.add("hidden");
  const resultDiv=document.getElementById("result"); resultDiv.classList.remove("hidden");
  resultDiv.innerHTML=`<h3>ğŸ“Š ê²°ê³¼</h3>`;
  let correct=0;
  questions.forEach((q,i)=>{
    const userAns=userAnswers[i];
    const isCorrect=userAns===q.answer;
    if(isCorrect) correct++;
    const userChoice=userAns!==null?q.options[userAns]:"(ë¬´ì‘ë‹µ)";
    const correctChoice=q.options[q.answer];
    const div=document.createElement("div");
    div.classList.add("question-result");
    div.style.background=isCorrect?"#e6ffed":"#ffe6e6";
    div.innerHTML=`<strong>${i+1}. ${q.question}</strong><br>ë‚´ ë‹µ: ${userChoice}<br>ì •ë‹µ: ${correctChoice}<br><b style="color:${isCorrect?'green':'red'}">${isCorrect?'ì •ë‹µ âœ…':'ì˜¤ë‹µ âŒ'}</b>`;
    resultDiv.appendChild(div);
  });
  const score=document.createElement("h4");
  score.textContent=`ì´ì : ${correct}/${questions.length}`;
  score.style.textAlign="center"; score.style.marginTop="20px";
  resultDiv.prepend(score);
  const retryBtn=document.createElement("button");
  retryBtn.innerText="ë‹¤ì‹œí•˜ê¸°"; retryBtn.onclick=()=>location.reload();
  retryBtn.style.display="block"; retryBtn.style.margin="20px auto";
  resultDiv.appendChild(retryBtn);
}
</script>
</body>
</html>
