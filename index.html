<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>백석대 성경고사</title>
<style>
  body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f9f9f9; }
  header { background:#f57c00; color:white; text-align:center; padding:15px; font-size:1.5em; }
  .container { max-width:800px; margin:20px auto; padding:20px; background:white; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.1);}
  button { margin:5px; padding:10px 15px; border:none; border-radius:5px; cursor:pointer; }
  .home-btn { background:#1976d2; color:white; }
  .nav-btn { background:#f57c00; color:white; }
  .submit-btn { background:#388e3c; color:white; }
  .question-img { max-width:100%; margin:10px 0; }
  .answer-feedback { margin:10px 0; padding:10px; border-radius:5px; }
  .correct { background:#c8e6c9; color:#256029; }
  .wrong { background:#ffcdd2; color:#b71c1c; }
  .timer { font-weight:bold; float:right; color:#d32f2f; }
</style>
</head>
<body>
<header>백석대 성경고사 <span id="timer" class="timer"></span></header>

<div class="container" id="app">
  <!-- 홈 화면 -->
  <div id="home-screen">
    <button onclick="startMode('practice')" class="nav-btn">연습문제</button>
    <button onclick="startMode('exam')" class="nav-btn">모의고사</button>
  </div>

  <!-- 문제 화면 -->
  <div id="quiz-screen" style="display:none;">
    <div id="question-container"></div>
    <div id="choices-container"></div>
    <div id="feedback-container"></div>
    <button onclick="prevQuestion()" class="nav-btn">이전</button>
    <button onclick="nextQuestion()" class="nav-btn">다음</button>
    <button onclick="submitExam()" class="submit-btn" id="submit-btn">제출</button>
    <button onclick="goHome()" class="home-btn">홈</button>
  </div>

  <!-- 결과 화면 -->
  <div id="result-screen" style="display:none;"></div>
</div>

<script>
let questions = [];
let currentIndex = 0;
let userAnswers = [];
let mode = '';
let timerInterval;
let totalTime = 600; // 10분 예시

async function loadQuestions() {
  const files = [1]; // 예: 1.txt만 사용
  const loaded = [];
  for(const num of files){
    try {
      const res = await fetch(`questions/${num}.txt`);
      if(res.ok){
        const txt = await res.text();
        loaded.push(...parseQuestions(txt));
      }
    } catch(e){ console.error(e); }
  }
  questions = shuffle(loaded);
}

function parseQuestions(txt){
  const blocks = txt.split(/\n(?=\d+\.)/); 
  const parsed = [];
  blocks.forEach(block => {
    const lines = block.split('\n').map(l=>l.trim()).filter(l=>l);
    if(lines.length < 3) return;
    let q = { text:'', img:'', choices:[], answer:'', explanation:'' };
    q.text = lines[0].replace(/^\d+\.\s*/, '');
    lines.forEach(l=>{
      if(l.startsWith('이미지:')) q.img = l.replace('이미지:','').trim();
      else if(/^\d+번:/.test(l)) q.choices.push(l);
      else if(l.startsWith('답:')) q.answer = l.replace('답:','').trim();
      else if(l.startsWith('해설:')) q.explanation = l.replace('해설:','').trim();
    });
    parsed.push(q);
  });
  return parsed;
}

function shuffle(array){ return array.sort(()=>Math.random()-0.5); }

function startMode(selectedMode){
  mode = selectedMode;
  document.getElementById('home-screen').style.display='none';
  document.getElementById('quiz-screen').style.display='block';
  userAnswers = Array(questions.length).fill(null);
  currentIndex = 0;
  displayQuestion();

  if(mode==='exam') startTimer();
  else document.getElementById('timer').textContent='';
}

function displayQuestion(){
  const q = questions[currentIndex];
  document.getElementById('question-container').innerHTML = `<h3>${currentIndex+1}. ${q.text}</h3>` + (q.img ? `<img src="questions/${q.img}" class="question-img">`:'');
  const choicesHtml = q.choices.map((c,i)=>`<div><input type="radio" name="choice" value="${i}" ${userAnswers[currentIndex]==i?'checked':''} onchange="selectAnswer(${i})"> ${c}</div>`).join('');
  document.getElementById('choices-container').innerHTML = choicesHtml;

  if(mode==='practice' && userAnswers[currentIndex]!==null){
    showFeedback();
  } else document.getElementById('feedback-container').innerHTML='';
}

function selectAnswer(i){
  userAnswers[currentIndex] = i;
  if(mode==='practice') showFeedback();
}

function showFeedback(){
  const q = questions[currentIndex];
  const fb = document.getElementById('feedback-container');
  const selected = userAnswers[currentIndex];
  if(selected == null) { fb.innerHTML=''; return; }
  if(q.choices[selected].startsWith(q.answer)){
    fb.innerHTML = `<div class="answer-feedback correct">정답! ${q.explanation || ''}</div>`;
  } else {
    fb.innerHTML = `<div class="answer-feedback wrong">오답! 정답: ${q.answer}. ${q.explanation || ''}</div>`;
  }
}

function nextQuestion(){ 
  if(currentIndex<questions.length-1){ currentIndex++; displayQuestion(); }
}
function prevQuestion(){ 
  if(currentIndex>0){ currentIndex--; displayQuestion(); }
}
function goHome(){ 
  document.getElementById('quiz-screen').style.display='none';
  document.getElementById('result-screen').style.display='none';
  document.getElementById('home-screen').style.display='block';
  clearInterval(timerInterval);
}

function submitExam(){
  if(mode!=='exam') return;
  clearInterval(timerInterval);
  document.getElementById('quiz-screen').style.display='none';
  const result = document.getElementById('result-screen');
  let score=0, html='<h2>결과</h2>';
  questions.forEach((q,i)=>{
    const selected = userAnswers[i];
    const correctIndex = q.choices.findIndex(c=>c.startsWith(q.answer));
    const isCorrect = selected === correctIndex;
    if(isCorrect) score++;
    html+=`<p>${i+1}. ${q.text}<br>정답: ${q.answer}, 선택: ${selected!==null?q.choices[selected]:'없음'} ${isCorrect?'✅':'❌'}<br>${q.explanation||''}</p>`;
  });
  html+=`<h3>점수: ${score} / ${questions.length}</h3>`;
  html+=`<button onclick="goHome()" class="home-btn">홈으로</button>`;
  result.innerHTML = html;
  result.style.display='block';
}

function startTimer(){
  let time = totalTime;
  const timerElem = document.getElementById('timer');
  timerInterval = setInterval(()=>{
    const min = Math.floor(time/60);
    const sec = time%60;
    timerElem.textContent = `${min}:${sec.toString().padStart(2,'0')}`;
    time--;
    if(time<0){ clearInterval(timerInterval); submitExam(); }
  },1000);
}

// 초기 로딩
loadQuestions();
</script>
</body>
</html>
