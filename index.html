<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>백석대 성경고사</title>
<style>
body {
  font-family: 'Noto Sans KR', sans-serif;
  background-color: #e6f0ff;
  text-align: center;
  margin: 0;
  padding: 10px;
}
h1 { color: #002366; font-size: 2em; margin-bottom: 10px; }
button {
  margin: 5px;
  padding: 10px 15px;
  font-size: 1em;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  background-color: #0056d6;
  color: white;
}
button:hover { background-color: #003c9d; }
#question-container {
  margin-top: 20px;
  padding: 15px;
  background: white;
  border-radius: 10px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  display: none;
}
.timer { font-size: 1.2em; color: #d9534f; font-weight: bold; }
@media(max-width:600px){
  button { font-size: 0.9em; padding: 8px 10px; }
}
</style>
</head>
<body>
<h1>📖 백석대 성경고사</h1>

<div id="home-screen">
  <button id="practice-btn">연습문제 시작</button>
  <button id="mock-btn">모의고사 시작</button>
</div>

<div id="range-selection" style="display:none;">
  <h2>범위를 선택하세요</h2>
  <div id="range-buttons"></div>
  <button id="range-back">⬅ 돌아가기</button>
</div>

<button id="home-btn" style="display:none;">🏠 홈으로</button>

<div id="question-container">
  <div class="timer" id="timer"></div>
  <h2 id="question"></h2>
  <div id="options"></div>
  <button id="prev-btn" style="display:none;">⬅ 이전문제</button>
  <button id="next-btn">다음문제 ➡</button>
  <button id="submit-btn" style="display:none;">제출하기</button>
  <div id="result"></div>
</div>

<script>
const ranges = ["고린도전서","고린도후서","갈라디아서","에베소서","빌립보서","골로새서",
"데살로니가전서","데살로니가후서","디모데전서","디모데후서","디도서","빌레몬서",
"히브리서","야고보서","베드로전서","베드로후서","요한일서","요한이서","요한삼서",
"유다서","요한계시록"];

let questions = [], currentIndex=0, mode="", score=0, answers=[], timer, timeLeft=0;

document.getElementById("practice-btn").onclick = ()=>showRangeSelection("practice");
document.getElementById("mock-btn").onclick = ()=>startMode("mock");
document.getElementById("home-btn").onclick = goHome;
document.getElementById("next-btn").onclick = nextQuestion;
document.getElementById("prev-btn").onclick = prevQuestion;
document.getElementById("submit-btn").onclick = showMockResult;
document.getElementById("range-back").onclick = ()=>{document.getElementById("range-selection").style.display="none";document.getElementById("home-screen").style.display="block";};

function showRangeSelection(selectedMode){
  mode = selectedMode;
  document.getElementById("home-screen").style.display="none";
  document.getElementById("range-selection").style.display="block";
  const container = document.getElementById("range-buttons");
  container.innerHTML="";
  ranges.forEach(range=>{
    const btn = document.createElement("button");
    btn.innerText = range;
    btn.onclick = ()=>startPracticeRange(range);
    container.appendChild(btn);
  });
}

async function startPracticeRange(range){
  document.getElementById("range-selection").style.display="none";
  document.getElementById("home-btn").style.display="block";
  document.getElementById("question-container").style.display="block";
  await loadQuestions([range]);
  showQuestion();
}

async function startMode(selectedMode){
  mode = selectedMode;
  document.getElementById("home-screen").style.display="none";
  document.getElementById("home-btn").style.display="block";
  document.getElementById("question-container").style.display="block";
  if(mode==="mock"){
    await loadQuestions(ranges);
    questions = getMockQuestions(questions,50);
    startTimer(3000); // 50분
    document.getElementById("prev-btn").style.display="inline";
    document.getElementById("submit-btn").style.display="inline";
  }
  showQuestion();
}

async function loadQuestions(rangeList){
  let loaded=[];
  for(const r of rangeList){
    try{
      const res = await fetch(`questions/${r}.txt`);
      if(res.ok){
        const txt = await res.text();
        loaded.push(...parseQuestions(txt));
      }
    }catch(e){console.log(e);}
  }
  questions=loaded;
}

function parseQuestions(text){
  const lines = text.split("\n").map(l=>l.trim()).filter(Boolean);
  const qs=[];
  let current={};
  lines.forEach(line=>{
    if(line.startsWith("답:")){
      current.answer = parseInt(line.replace("답:","").trim())-1;
      qs.push(current);
      current={};
    } else if(!current.question){
      current.question = line;
      current.options=[];
    } else {
      current.options.push(line.replace(/^\d번:\s*/,""));
    }
  });
  return qs;
}

function getMockQuestions(allQuestions,total){
  const mock=[];
  const perRange = Math.ceil(total/ranges.length);
  ranges.forEach(range=>{
    const rangeQs = allQuestions.filter(q=>q.range===range);
    shuffle(rangeQs);
    mock.push(...rangeQs.slice(0,perRange));
  });
  shuffle(mock);
  return mock.slice(0,total);
}

function showQuestion(){
  if(currentIndex>=questions.length) return;
  const q = questions[currentIndex];
  document.getElementById("question").innerText=`(${currentIndex+1}) ${q.question}`;
  const optionsDiv = document.getElementById("options");
  optionsDiv.innerHTML="";
  q.options.forEach((opt,i)=>{
    const btn = document.createElement("button");
    btn.innerText=opt;
    btn.onclick=()=>selectAnswer(i);
    optionsDiv.appendChild(btn);
  });
  document.getElementById("result").innerText="";
}

function selectAnswer(i){
  const q = questions[currentIndex];
  if(mode==="practice"){
    if(i===q.answer){
      document.getElementById("result").innerHTML=`✅ 정답입니다!<br>정답: ${q.options[q.answer]}`;
    }else{
      document.getElementById("result").innerHTML=`❌ 오답입니다.<br>정답: ${q.options[q.answer]}`;
    }
  } else { // mock
    answers[currentIndex]=i;
    nextQuestion();
  }
}

function nextQuestion(){
  if(currentIndex<questions.length-1){
    currentIndex++;
    showQuestion();
  }
}
function prevQuestion(){
  if(currentIndex>0){
    currentIndex--;
    showQuestion();
  }
}

function showMockResult(){
  clearInterval(timer);
  let resultHTML=`<h2>결과</h2>`;
  let score=0;
  questions.forEach((q,i)=>{
    const correct=q.answer;
    const selected=answers[i];
    if(selected===correct) score++;
    resultHTML+=`<p>${i+1}번 - 선택: ${selected!==undefined?q.options[selected]:"미응답"}, 정답: ${q.options[correct]} ${selected===correct?"✅":"❌"}</p>`;
  });
  resultHTML=`<h3>총점: ${Math.round(score/questions.length*100)}점</h3>`+resultHTML;
  document.getElementById("question").innerHTML=resultHTML;
  document.getElementById("options").innerHTML="";
  document.getElementById("next-btn").style.display="none";
  document.getElementById("prev-btn").style.display="none";
  document.getElementById("submit-btn").style.display="none";
  document.getElementById("timer").innerText="";
}

function startTimer(sec){
  timeLeft=sec;
  timer=setInterval(()=>{
    const min=Math.floor(timeLeft/60);
    const s=timeLeft%60;
    document.getElementById("timer").innerText=`⏰ 남은 시간: ${min}분 ${s<10?"0"+s:s}초`;
    if(timeLeft--<=0){
      clearInterval(timer);
      showMockResult();
    }
  },1000);
}

function goHome(){
  document.getElementById("home-screen").style.display="block";
  document.getElementById("range-selection").style.display="none";
  document.getElementById("home-btn").style.display="none";
  document.getElementById("question-container").style.display="none";
  clearInterval(timer);
  currentIndex=0;
  answers=[];
  score=0;
}

function shuffle(arr){return arr.sort(()=>Math.random()-0.5);}
</script>
</body>
</html>
