<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ë°±ì„ëŒ€ ì„±ê²½ê³ ì‚¬</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { font-family: 'Noto Sans KR', sans-serif; background-color: #e6f0ff; margin:0; padding:20px; text-align:center;}
  h1 { color:#002366; font-size:2em; margin-bottom:10px;}
  button { margin:5px; padding:10px 16px; font-size:1em; border:none; border-radius:10px; cursor:pointer; background-color:#0056d6; color:white; transition:0.3s;}
  button:hover { background-color:#003c9d;}
  #question-container { margin-top:20px; padding:20px; background:white; border-radius:15px; box-shadow:0 4px 8px rgba(0,0,0,0.1); display:none; max-width:600px; margin-left:auto; margin-right:auto;}
  .timer { font-size:1.2em; color:#d9534f; font-weight:bold; margin-bottom:10px;}
  #result { margin-top:10px; font-weight:bold;}
  @media(max-width:600px){ button{width:80%; margin:5px 0; }}
</style>
</head>
<body>

<h1>ğŸ“– ë°±ì„ëŒ€ ì„±ê²½ê³ ì‚¬</h1>

<div id="home-screen">
  <button id="practice-btn">ì—°ìŠµë¬¸ì œ ì‹œì‘</button>
  <button id="mock-btn">ëª¨ì˜ê³ ì‚¬ ì‹œì‘</button>
</div>

<div id="range-selection" style="display:none;">
  <h2>ì—°ìŠµë¬¸ì œ ë²”ìœ„ ì„ íƒ</h2>
  <div id="range-buttons"></div>
  <button id="range-back">â¬… ë’¤ë¡œ</button>
</div>

<button id="home-btn" style="display:none;">ğŸ  í™ˆìœ¼ë¡œ</button>

<div id="question-container">
  <div id="timer" class="timer"></div>
  <h2 id="question"></h2>
  <div id="options"></div>
  <button id="prev-btn" style="display:none;">â¬… ì´ì „</button>
  <button id="next-btn" style="display:none;">ë‹¤ìŒ â¡</button>
  <button id="submit-btn" style="display:none;">ì œì¶œí•˜ê¸°</button>
  <div id="result"></div>
</div>

<script>
let questions=[], currentIndex=0, mode='', answers=[], timer, timeLeft=0;

// ì„±ê²½ ë²”ìœ„
const ranges = [
  {name:"ê³ ë¦°ë„ì „ì„œ", file:"1.txt"},
  {name:"ê³ ë¦°ë„í›„ì„œ", file:"2.txt"},
  {name:"ê°ˆë¼ë””ì•„ì„œ", file:"3.txt"},
  {name:"ì—ë² ì†Œì„œ", file:"4.txt"},
  {name:"ë¹Œë¦½ë³´ì„œ", file:"5.txt"},
  {name:"ê³¨ë¡œìƒˆì„œ", file:"6.txt"},
  {name:"ë°ì‚´ë¡œë‹ˆê°€ì „ì„œ", file:"7.txt"},
  {name:"ë°ì‚´ë¡œë‹ˆê°€í›„ì„œ", file:"8.txt"},
  {name:"ë””ëª¨ë°ì „ì„œ", file:"9.txt"},
  {name:"ë””ëª¨ë°í›„ì„œ", file:"10.txt"},
  {name:"ë””ë„ì„œ", file:"11.txt"},
  {name:"ë¹Œë ˆëª¬ì„œ", file:"12.txt"},
  {name:"íˆë¸Œë¦¬ì„œ", file:"13.txt"},
  {name:"ì•¼ê³ ë³´ì„œ", file:"14.txt"},
  {name:"ë² ë“œë¡œì „ì„œ", file:"15.txt"},
  {name:"ë² ë“œë¡œí›„ì„œ", file:"16.txt"},
  {name:"ìš”í•œì¼ì„œ", file:"17.txt"},
  {name:"ìš”í•œì´ì„œ", file:"18.txt"},
  {name:"ìš”í•œì‚¼ì„œ", file:"19.txt"},
  {name:"ìœ ë‹¤ì„œ", file:"20.txt"},
  {name:"ìš”í•œê³„ì‹œë¡", file:"21.txt"},
];

// ë²„íŠ¼ ì´ë²¤íŠ¸
document.getElementById("practice-btn").onclick = ()=> showRangeSelection();
document.getElementById("mock-btn").onclick = ()=> startMode("mock");
document.getElementById("home-btn").onclick = goHome;
document.getElementById("next-btn").onclick = nextQuestion;
document.getElementById("prev-btn").onclick = prevQuestion;
document.getElementById("submit-btn").onclick = showMockResult;
document.getElementById("range-back").onclick = ()=>{document.getElementById("range-selection").style.display="none";document.getElementById("home-screen").style.display="block";}

// ë²”ìœ„ ì„ íƒ UI
function showRangeSelection(){
  document.getElementById("home-screen").style.display="none";
  const container = document.getElementById("range-buttons");
  container.innerHTML="";
  ranges.forEach((r,i)=>{
    const btn = document.createElement("button");
    btn.innerText=r.name;
    btn.onclick = ()=> startMode("practice", r);
    container.appendChild(btn);
  });
  document.getElementById("range-selection").style.display="block";
}

// ì‹œì‘
async function startMode(selectedMode, range=null){
  mode=selectedMode;
  document.getElementById("home-btn").style.display="block";
  document.getElementById("home-screen").style.display="none";
  document.getElementById("range-selection").style.display="none";
  document.getElementById("question-container").style.display="block";
  answers=[];
  currentIndex=0;

  if(mode==="practice" && range){
    questions = await loadQuestions([range.file]);
  } else if(mode==="mock"){
    const allQuestions = await loadQuestions(ranges.map(r=>r.file));
    let selected=[];
    ranges.forEach(r=>{
      const rqs = allQuestions.filter(q=>q.range===r.name);
      if(rqs.length>0){
        const count = Math.min(rqs.length, Math.floor(Math.random()*5)+1);
        selected.push(...shuffleArray(rqs).slice(0,count));
      }
    });
    // ì´ 50ë¬¸ì œ ë§ì¶”ê¸°
    while(selected.length<50){
      const remaining = allQuestions.filter(q=>!selected.includes(q));
      if(remaining.length===0) break;
      selected.push(remaining[Math.floor(Math.random()*remaining.length)]);
    }
    questions = shuffleArray(selected).slice(0,50);
    startTimer(3000); // 50ë¶„
    document.getElementById("prev-btn").style.display="inline";
    document.getElementById("submit-btn").style.display="inline";
  }
  showQuestion();
}

// ë¬¸ì œ ë¶ˆëŸ¬ì˜¤ê¸°
async function loadQuestions(files){
  let loaded=[];
  for(const f of files){
    try{
      const res = await fetch(`questions/${f}`);
      if(res.ok){
        const txt = await res.text();
        const qs = parseQuestions(txt, f);
        loaded.push(...qs);
      }
    }catch(e){console.log(e);}
  }
  return loaded;
}

// ë¬¸ì œ íŒŒì‹±
function parseQuestions(text, rangeName){
  const lines = text.split("\n").map(l=>l.trim()).filter(Boolean);
  const qs=[];
  let current={options:[]};
  lines.forEach(line=>{
    if(line.startsWith("ë‹µ:")){
      current.answer = parseInt(line.replace("ë‹µ:","").trim())-1;
      current.range = rangeName;
      qs.push(current);
      current={options:[]};
    } else if(!current.question){
      current.question=line;
    } else {
      current.options.push(line.replace(/^\dë²ˆ:\s*/,""));
    }
  });
  return qs;
}

// âœ… ë¬¸ì œ ë°ì´í„° ì˜ˆì‹œ
const questions = [
  {
    question: "ìš”í•œê³„ì‹œë¡ 15ì¥ì—ì„œ ì§ìŠ¹ê³¼ ê·¸ì˜ ìš°ìƒê³¼ ê·¸ì˜ ì´ë¦„ì˜ ìˆ˜ë¥¼ ì´ê¸°ê³  ë²—ì–´ë‚œ ìë“¤ì´ ìœ ë¦¬ ë°”ë‹¤ ê°€ì— ì„œì„œ ë¶€ë¥´ëŠ” ë…¸ë˜ëŠ” ë¬´ìŠ¨ ë…¸ë˜ì¸ê°€?(ë‘ ê°€ì§€)",
    options: [
      "ì¸ìì˜ ë…¸ë˜",
      "ì–´ë¦° ì–‘ì˜ ë…¸ë˜",
      "ìƒˆ ë…¸ë˜",
      "ìŠ¹ë¦¬ì˜ ë…¸ë˜",
      "ì‹­ì‚¬ë§Œì‚¬ì²œì˜ ë…¸ë˜",
      "ëª¨ì„¸ì˜ ë…¸ë˜"
    ],
    answer: [1, 5] // 2ë²ˆ, 6ë²ˆ (index ê¸°ì¤€ì´ë¯€ë¡œ 0ë¶€í„° ì‹œì‘)
  },
  // ë‹¤ë¥¸ ë¬¸ì œë“¤...
];

// âœ… ì „ì—­ ë³€ìˆ˜
let currentIndex = 0;
let answers = [];
let mode = "practice"; // "exam"ì´ë©´ ëª¨ì˜ê³ ì‚¬ ëª¨ë“œ

// âœ… ë¬¸ì œ í‘œì‹œ í•¨ìˆ˜
function showQuestion() {
  const q = questions[currentIndex];
  let html = `<h3>${currentIndex + 1}. ${q.question}</h3>`;
  q.options.forEach((opt, i) => {
    html += `
      <button onclick="selectAnswer(${i})" id="opt${i}" class="option-btn">
        ${i + 1}. ${opt}
      </button><br>
    `;
  });
  document.getElementById("question").innerHTML = html;
  document.getElementById("result").innerHTML = "";
}

// âœ… ë‹µ ì„ íƒ í•¨ìˆ˜ (ë³µìˆ˜ ì •ë‹µ ì§€ì›)
function selectAnswer(i) {
  const q = questions[currentIndex];

  // ì •ë‹µì´ ë°°ì—´ì´ë©´ ë³µìˆ˜ì •ë‹µ ë¬¸ì œ
  if (Array.isArray(q.answer)) {
    if (!answers[currentIndex]) answers[currentIndex] = [];
    const selected = answers[currentIndex];

    // ì´ë¯¸ ì„ íƒí•œ ë³´ê¸° ë‹¤ì‹œ í´ë¦­ ì‹œ ì„ íƒ ì·¨ì†Œ
    if (selected.includes(i)) {
      answers[currentIndex] = selected.filter(x => x !== i);
      document.getElementById(`opt${i}`).style.background = "";
    } else {
      answers[currentIndex].push(i);
      document.getElementById(`opt${i}`).style.background = "#d0f0c0";
    }

    // ì—°ìŠµ ëª¨ë“œì—ì„œëŠ” ì •ë‹µ ì¦‰ì‹œ í™•ì¸
    if (mode === "practice" && answers[currentIndex].length === q.answer.length) {
      checkAnswer();
    }

  } else {
    // ë‹¨ì¼ ì •ë‹µ ë¬¸ì œ
    answers[currentIndex] = i;
    if (mode === "practice") {
      checkAnswer();
    }
  }
}

// âœ… ì •ë‹µ í™•ì¸ í•¨ìˆ˜
function checkAnswer() {
  const q = questions[currentIndex];
  const userAnswer = answers[currentIndex];

  let isCorrect = false;

  if (Array.isArray(q.answer)) {
    // ë³µìˆ˜ ì •ë‹µ ë¹„êµ
    isCorrect =
      q.answer.length === userAnswer.length &&
      q.answer.every(a => userAnswer.includes(a));
  } else {
    isCorrect = userAnswer === q.answer;
  }

  if (isCorrect) {
    document.getElementById("result").innerHTML =
      `âœ… ì •ë‹µì…ë‹ˆë‹¤!<br>ì •ë‹µ: ${q.answer.map(a => q.options[a]).join(", ")}`;
  } else {
    document.getElementById("result").innerHTML =
      `âŒ ì˜¤ë‹µì…ë‹ˆë‹¤.<br>ì •ë‹µ: ${Array.isArray(q.answer)
        ? q.answer.map(a => q.options[a]).join(", ")
        : q.options[q.answer]}`;
  }
}

// âœ… ë‹¤ìŒ / ì´ì „ ë¬¸ì œ ì´ë™
function nextQuestion() {
  if (currentIndex < questions.length - 1) {
    currentIndex++;
    showQuestion();
  }
}
function prevQuestion() {
  if (currentIndex > 0) {
    currentIndex--;
    showQuestion();
  }
}

// âœ… ì œì¶œ (ëª¨ì˜ê³ ì‚¬ìš©)
function submitExam() {
  let correctCount = 0;
  let resultHTML = "<h3>ğŸ“˜ ê²°ê³¼ í™•ì¸</h3>";

  questions.forEach((q, idx) => {
    const userAns = answers[idx];
    let correct = false;

    if (Array.isArray(q.answer)) {
      correct =
        userAns &&
        q.answer.length === userAns.length &&
        q.answer.every(a => userAns.includes(a));
    } else {
      correct = userAns === q.answer;
    }

    if (correct) correctCount++;

    resultHTML += `
      <p>
        <strong>${idx + 1}. ${q.question}</strong><br>
        âœ… ì •ë‹µ: ${Array.isArray(q.answer)
          ? q.answer.map(a => q.options[a]).join(", ")
          : q.options[q.answer]}<br>
        ğŸ“ ë‚´ê°€ ì„ íƒí•œ ë‹µ: ${
          userAns
            ? Array.isArray(userAns)
              ? userAns.map(a => q.options[a]).join(", ")
              : q.options[userAns]
            : "ì„ íƒ ì•ˆ í•¨"
        }<br>
        ${correct ? "âœ… ë§ìŒ" : "âŒ í‹€ë¦¼"}
      </p>
    `;
  });

  resultHTML += `<h4>ì´ ì ìˆ˜: ${correctCount} / ${questions.length}</h4>`;
  document.getElementById("question").innerHTML = resultHTML;
}

// ì´ì „/ë‹¤ìŒ
function nextQuestion(){
  if(currentIndex<questions.length-1){ currentIndex++; showQuestion(); }
}
function prevQuestion(){
  if(currentIndex>0){ currentIndex--; showQuestion(); }
}

// ëª¨ì˜ê³ ì‚¬ ê²°ê³¼
function showMockResult() {
  clearInterval(timer);
  let score = 0;
  let html = "<h3>ê²°ê³¼</h3>";

  questions.forEach((q, i) => {
    const correctIndex = q.answer; // ì •ë‹µ ì¸ë±ìŠ¤
    const userIndex = answers[i];   // ì‚¬ìš©ìê°€ ì„ íƒí•œ ì¸ë±ìŠ¤
    const isCorrect = userIndex === correctIndex;
    if (isCorrect) score++;

    html += `
      <div style="margin-bottom:15px; padding:10px; border-bottom:1px solid #ccc;">
        <p><strong>ë¬¸ì œ ${i + 1}:</strong> ${q.question}</p>
        <p>ì„ íƒ: ${userIndex !== undefined ? q.options[userIndex] : "-"} ${isCorrect ? "âœ…" : "âŒ"}</p>
        <p>ì •ë‹µ: ${q.options[correctIndex]}</p>
        ${q.explanation ? `<p>í•´ì„¤: ${q.explanation}</p>` : ""}
      </div>
    `;
  });

  html = `<h2>ì´ì : ${Math.round(score / questions.length * 100)}</h2>` + html;

  document.getElementById("question").innerHTML = html;
  document.getElementById("options").innerHTML = "";
  document.getElementById("prev-btn").style.display = "none";
  document.getElementById("next-btn").style.display = "none";
  document.getElementById("submit-btn").style.display = "none";
  document.getElementById("timer").innerText = "";
}
// íƒ€ì´ë¨¸
function startTimer(seconds){
  timeLeft=seconds;
  timer=setInterval(()=>{
    const min=Math.floor(timeLeft/60);
    const sec=timeLeft%60;
    document.getElementById("timer").innerText=`â° ë‚¨ì€ ì‹œê°„: ${min}ë¶„ ${sec<10?"0"+sec:sec}ì´ˆ`;
    if(timeLeft--<=0){ clearInterval(timer); showMockResult(); }
  },1000);
}

// í™ˆ ì´ë™
function goHome(){
  clearInterval(timer);
  document.getElementById("home-screen").style.display="block";
  document.getElementById("range-selection").style.display="none";
  document.getElementById("question-container").style.display="none";
  document.getElementById("home-btn").style.display="none";
  answers=[]; currentIndex=0; questions=[];
}

// ë°°ì—´ ì„ê¸°
function shuffleArray(arr){ return arr.sort(()=>Math.random()-0.5);}
</script>

</body>
</html>
