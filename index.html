<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì„±ê²½ê³ ì‚¬ ë¬¸ì œì€í–‰</title>
<style>
  body { font-family: 'Noto Sans KR', sans-serif; background: #f4f8fc; text-align: center; margin: 0; padding: 20px; }
  h1 { color: #003366; }
  button { background: #0056d6; color: white; border: none; padding: 10px 18px; border-radius: 10px; cursor: pointer; margin: 5px; font-size: 16px; }
  button:hover { background: #003c9d; }
  .selected { background: #003c9d !important; }
  #question-container, #result-screen, #range-selection { display: none; }
  #options button { display: block; width: 90%; max-width: 400px; margin: 8px auto; text-align: left; }
  #timer { font-size: 18px; color: #d62828; margin-top: 10px; }
</style>
</head>
<body>

<h1>ğŸ“– ì„±ê²½ê³ ì‚¬ ë¬¸ì œì€í–‰</h1>

<!-- í™ˆ í™”ë©´ -->
<div id="home-screen">
  <button id="practice-btn">ì—°ìŠµë¬¸ì œ</button>
  <button id="mock-btn">ëª¨ì˜ê³ ì‚¬</button>
</div>

<!-- ë²”ìœ„ ì„ íƒ -->
<div id="range-selection">
  <h2>ë²”ìœ„ë¥¼ ì„ íƒí•˜ì„¸ìš”</h2>
  <div id="range-buttons"></div>
  <button id="range-back">ë’¤ë¡œê°€ê¸°</button>
</div>

<!-- ë¬¸ì œ í™”ë©´ -->
<div id="question-container">
  <div id="timer"></div>
  <h3 id="question-title"></h3>
  <div id="options"></div>
  <div>
    <button id="prev-btn">ì´ì „</button>
    <button id="next-btn">ë‹¤ìŒ</button>
    <button id="submit-btn">ì œì¶œ</button>
  </div>
  <p id="result"></p>
</div>

<!-- ê²°ê³¼ í™”ë©´ -->
<div id="result-screen">
  <h2>ğŸ“Š ëª¨ì˜ê³ ì‚¬ ê²°ê³¼</h2>
  <p id="score"></p>
  <button id="home-btn">í™ˆìœ¼ë¡œ</button>
</div>

<script>
let questions=[], currentIndex=0, mode='', answers=[], timer, timeLeft=0;

// ë²”ìœ„ ëª©ë¡
const ranges = [
  {name:"ê³ ë¦°ë„ì „ì„œ", file:"1.txt"},
  {name:"ê³ ë¦°ë„í›„ì„œ", file:"2.txt"},
  {name:"ê°ˆë¼ë””ì•„ì„œ", file:"3.txt"},
  {name:"ì—ë² ì†Œì„œ", file:"4.txt"},
  {name:"ë¹Œë¦½ë³´ì„œ", file:"5.txt"},
  {name:"ê³¨ë¡œìƒˆì„œ", file:"6.txt"},
  {name:"ë°ì‚´ë¡œë‹ˆê°€ì „ì„œ", file:"7.txt"},
  {name:"ë°ì‚´ë¡œë‹ˆê°€í›„ì„œ", file:"8.txt"},
  {name:"ë””ëª¨ë°ì „ì„œ", file:"9.txt"},
  {name:"ë””ëª¨ë°í›„ì„œ", file:"10.txt"},
  {name:"ë””ë„ì„œ", file:"11.txt"},
  {name:"ë¹Œë ˆëª¬ì„œ", file:"12.txt"},
  {name:"íˆë¸Œë¦¬ì„œ", file:"13.txt"},
  {name:"ì•¼ê³ ë³´ì„œ", file:"14.txt"},
  {name:"ë² ë“œë¡œì „ì„œ", file:"15.txt"},
  {name:"ë² ë“œë¡œí›„ì„œ", file:"16.txt"},
  {name:"ìš”í•œì¼ì„œ", file:"17.txt"},
  {name:"ìš”í•œì´ì„œ", file:"18.txt"},
  {name:"ìš”í•œì‚¼ì„œ", file:"19.txt"},
  {name:"ìœ ë‹¤ì„œ", file:"20.txt"},
  {name:"ìš”í•œê³„ì‹œë¡", file:"21.txt"},
];

// ë²„íŠ¼ ì—°ê²°
window.onload = ()=>{
  document.getElementById("practice-btn").onclick = ()=> showRangeSelection();
  document.getElementById("mock-btn").onclick = ()=> startMode("mock");
  document.getElementById("home-btn").onclick = goHome;
  document.getElementById("next-btn").onclick = nextQuestion;
  document.getElementById("prev-btn").onclick = prevQuestion;
  document.getElementById("submit-btn").onclick = showMockResult;
  document.getElementById("range-back").onclick = ()=>{
    document.getElementById("range-selection").style.display="none";
    document.getElementById("home-screen").style.display="block";
  };
};

// ë²”ìœ„ ì„ íƒ
function showRangeSelection(){
  document.getElementById("home-screen").style.display="none";
  const container = document.getElementById("range-buttons");
  container.innerHTML="";
  ranges.forEach(r=>{
    const btn = document.createElement("button");
    btn.innerText = r.name;
    btn.onclick = ()=> startMode("practice", r);
    container.appendChild(btn);
  });
  document.getElementById("range-selection").style.display="block";
}

// ì‹œì‘
async function startMode(selectedMode, range=null){
  mode = selectedMode;
  answers=[]; currentIndex=0;
  document.getElementById("home-screen").style.display="none";
  document.getElementById("range-selection").style.display="none";
  document.getElementById("question-container").style.display="block";
  document.getElementById("result").innerHTML="";

  if(mode==="practice" && range){
    questions = await loadQuestions([range.file]);
  } else if(mode==="mock"){
    const allQuestions = await loadQuestions(ranges.map(r=>r.file));
    questions = shuffleArray(allQuestions).slice(0,50);
    startTimer(3000); // 50ë¶„ ì œí•œ
    document.getElementById("submit-btn").style.display="inline";
  }

  showQuestion();
}

// ë¬¸ì œ ë¡œë“œ
async function loadQuestions(files){
  let loaded=[];
  for(const f of files){
    try{
      const res = await fetch(`questions/${f}`);
      if(res.ok){
        const txt = await res.text();
        const qs = parseQuestions(txt, f);
        loaded.push(...qs);
      }
    }catch(e){console.error(e);}
  }
  return loaded;
}

// ë¬¸ì œ íŒŒì‹±
function parseQuestions(text, file){
  const lines = text.split("\n").map(x=>x.trim()).filter(x=>x);
  let result=[], current={range:file.replace(".txt","")};
  for(const line of lines){
    if(/^\d+\./.test(line)){
      if(current.question) result.push(current);
      current = {range:file.replace(".txt",""), question:line, options:[], answer:[]};
    } else if(/^\d/.test(line[0])){
      current.options.push(line.replace(/^\d+\s*[\.:]?\s*/,"").trim());
    } else if(line.startsWith("ë‹µ:")){
      current.answer = line.replace("ë‹µ:","").split(",").map(x=>parseInt(x.trim())-1);
    }
  }
  if(current.question) result.push(current);
  return result;
}

// ë¬¸ì œ í‘œì‹œ
function showQuestion(){
  const q = questions[currentIndex];
  document.getElementById("question-title").innerText = `${currentIndex+1}. ${q.question}`;
  const optionsDiv = document.getElementById("options");
  optionsDiv.innerHTML="";
  q.userSelected = q.userSelected || [];
  q.options.forEach((opt,i)=>{
    const btn = document.createElement("button");
    btn.innerText = opt;
    if(q.userSelected.includes(i)) btn.classList.add("selected");
    btn.onclick = ()=>{
      const idx = q.userSelected.indexOf(i);
      if(idx>=0){
        q.userSelected.splice(idx,1);
        btn.classList.remove("selected");
      } else {
        q.userSelected.push(i);
        btn.classList.add("selected");
      }

      // ì •ë‹µ ìˆ˜ë§Œí¼ ì„ íƒë˜ì—ˆì„ ë•Œë§Œ ì²˜ë¦¬
      if(q.userSelected.length === q.answer.length){
        if(mode==="practice"){
          checkAnswer(q);
        } else if(mode==="mock"){
          answers[currentIndex] = [...q.userSelected];
          nextQuestion();
        }
      }
    };
    optionsDiv.appendChild(btn);
  });
}

// ì •ë‹µ í™•ì¸
function checkAnswer(q){
  const sortedUser = q.userSelected.slice().sort().toString();
  const sortedAns = q.answer.slice().sort().toString();
  const isCorrect = sortedUser === sortedAns;
  document.getElementById("result").innerHTML = isCorrect 
    ? `âœ… ì •ë‹µì…ë‹ˆë‹¤!<br>ì •ë‹µ: ${q.answer.map(i=>q.options[i]).join(", ")}`
    : `âŒ ì˜¤ë‹µì…ë‹ˆë‹¤.<br>ì •ë‹µ: ${q.answer.map(i=>q.options[i]).join(", ")}`;
}

// ì´ì „ / ë‹¤ìŒ
function nextQuestion(){
  if(currentIndex < questions.length-1){
    currentIndex++;
    showQuestion();
  } else if(mode==="mock"){
    showMockResult();
  }
}
function prevQuestion(){
  if(currentIndex>0){
    currentIndex--;
    showQuestion();
  }
}

// ëª¨ì˜ê³ ì‚¬ ê²°ê³¼
function showMockResult(){
  let score = 0;
  questions.forEach((q,i)=>{
    const ans = answers[i] || [];
    const sortedUser = ans.slice().sort().toString();
    const sortedAns = q.answer.slice().sort().toString();
    if(sortedUser === sortedAns) score++;
  });
  document.getElementById("question-container").style.display="none";
  document.getElementById("result-screen").style.display="block";
  document.getElementById("score").innerText = `ì´ ${questions.length}ë¬¸ì œ ì¤‘ ${score}ë¬¸ì œ ì •ë‹µ! (${Math.round(score/questions.length*100)}ì )`;
  clearInterval(timer);
}

// íƒ€ì´ë¨¸
function startTimer(sec){
  timeLeft = sec;
  const timerDiv = document.getElementById("timer");
  clearInterval(timer);
  timer = setInterval(()=>{
    const m = Math.floor(timeLeft/60);
    const s = timeLeft%60;
    timerDiv.innerText = `â° ë‚¨ì€ ì‹œê°„: ${m}:${s.toString().padStart(2,"0")}`;
    if(timeLeft<=0){
      clearInterval(timer);
      showMockResult();
    }
    timeLeft--;
  },1000);
}

// í™ˆìœ¼ë¡œ
function goHome(){
  clearInterval(timer);
  document.getElementById("result-screen").style.display="none";
  document.getElementById("question-container").style.display="none";
  document.getElementById("home-screen").style.display="block";
  document.getElementById("submit-btn").style.display="none";
}

// ìœ í‹¸
function shuffleArray(arr){return arr.sort(()=>Math.random()-0.5);}
</script>

</body>
</html>
