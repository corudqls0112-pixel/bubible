<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ğŸ“˜ ë°±ì„ëŒ€ ì¡¸ì—…ê³ ì‚¬</title>
  <style>
    body {
      font-family: "Noto Sans KR", sans-serif;
      background-color: #004a99; /* ë°±ì„ëŒ€ íŒŒë€ìƒ‰ */
      color: #fff;
      text-align: center;
      margin: 0;
      padding: 30px;
    }
    #app {
      background: white;
      color: black;
      max-width: 700px;
      margin: 0 auto;
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 0 20px rgba(0,0,0,0.3);
    }
    button {
      background: #004a99;
      color: white;
      border: none;
      padding: 10px 18px;
      border-radius: 10px;
      cursor: pointer;
      margin: 5px;
      transition: 0.2s;
    }
    button:hover {
      background: #0066cc;
    }
    .answer {
      margin-top: 15px;
      background: #f0f8ff;
      padding: 15px;
      border-radius: 10px;
    }
  </style>
</head>
<body>
  <div id="app">
    <h1>ğŸ“– ë°±ì„ëŒ€ ì¡¸ì—…ê³ ì‚¬</h1>
    <p>ì›í•˜ëŠ” ëª¨ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”</p>
    <button onclick="startMode('practice')">ì—°ìŠµë¬¸ì œ</button>
    <button onclick="startMode('exam')">ëª¨ì˜ê³ ì‚¬</button>
  </div>

  <script>
    let questions = [];
    let currentQuestion = 0;
    let answers = [];
    let timer;
    let timeLeft = 0;
    let mode = ""; // 'practice' or 'exam'
    const totalExamTime = 50 * 60; // 50ë¶„

    async function startMode(selectedMode) {
      mode = selectedMode;
      document.getElementById("app").innerHTML = "<h2>ë¬¸ì œ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</h2>";
      await loadQuestions();
      if (mode === "practice") startPracticeMode();
      else startExamMode();
    }

    async function loadQuestions() {
      const files = [1]; // ì˜ˆì‹œë¡œ 1.txtë§Œ ì‚¬ìš©
      let loaded = [];
      for (const num of files) {
        try {
          const res = await fetch(`questions/${num}.txt`);
          if (res.ok) {
            const text = await res.text();
            loaded = loaded.concat(parseQuestions(text));
          }
        } catch (err) {
          console.error(err);
        }
      }
      // ë¬¸ì œ ë‹¨ìœ„ë¡œ ëœë¤
      questions = shuffle(loaded);
    }

    function parseQuestions(text) {
      const blocks = text.split(/\n(?=\d+\.)/);
      return blocks.map(block => {
        const lines = block.trim().split('\n').filter(Boolean);
        const question = lines[0];
        const options = lines.slice(1, 5);
        const answerLine = lines.find(l => l.startsWith("ì •ë‹µ:"));
        const explanationLine = lines.find(l => l.startsWith("í•´ì„¤:"));
        const answer = answerLine ? answerLine.replace("ì •ë‹µ:", "").trim() : "";
        const explanation = explanationLine ? explanationLine.replace("í•´ì„¤:", "").trim() : "";
        return { question, options, answer, explanation };
      }).filter(q => q.question && q.options.length);
    }

    function startPracticeMode() {
      currentQuestion = 0;
      answers = [];
      displayPracticeQuestion();
    }

    function startExamMode() {
      currentQuestion = 0;
      answers = [];
      timeLeft = totalExamTime;
      questions = shuffle(questions).slice(0, 50); // 50ë¬¸ì œë§Œ ëœë¤
      displayExamQuestion();
      startTimer();
    }

    function displayPracticeQuestion() {
      const q = questions[currentQuestion];
      const app = document.getElementById("app");
      app.innerHTML = `
        <h2>ì—°ìŠµë¬¸ì œ ${currentQuestion + 1}/${questions.length}</h2>
        <p>${q.question}</p>
        ${q.options.map((opt, i) => 
          `<button onclick="checkPracticeAnswer(${i})">${opt}</button>`
        ).join("")}
        <div>
          <button onclick="prevQuestion()">ì´ì „</button>
          <button onclick="nextQuestion()">ë‹¤ìŒ</button>
          <button onclick="goHome()">ğŸ  í™ˆ</button>
        </div>
      `;
    }

    function checkPracticeAnswer(selectedIndex) {
      const q = questions[currentQuestion];
      const selected = q.options[selectedIndex];
      const isCorrect = selected.includes(q.answer);
      const app = document.getElementById("app");
      app.innerHTML += `
        <div class="answer">
          <p>${isCorrect ? "âœ… ì •ë‹µì…ë‹ˆë‹¤!" : "âŒ ì˜¤ë‹µì…ë‹ˆë‹¤!"}</p>
          <p><b>ì •ë‹µ:</b> ${q.answer}</p>
          ${q.explanation ? `<p><b>í•´ì„¤:</b> ${q.explanation}</p>` : ""}
        </div>
      `;
    }

    function displayExamQuestion() {
      const q = questions[currentQuestion];
      const app = document.getElementById("app");
      app.innerHTML = `
        <h2>ëª¨ì˜ê³ ì‚¬ ${currentQuestion + 1}/${questions.length}</h2>
        <div id="timerDiv">â° ë‚¨ì€ ì‹œê°„: ${formatTime(timeLeft)}</div>
        <p>${q.question}</p>
        ${q.options.map((opt, i) => 
          `<button onclick="selectExamAnswer(${i})"
           style="${answers[currentQuestion]===i ? 'background:#004a99;' : ''}">
           ${opt}</button>`
        ).join("")}
        <div>
          <button onclick="prevQuestion()">ì´ì „</button>
          <button onclick="nextQuestion()">ë‹¤ìŒ</button>
          <button onclick="submitExam()">ì œì¶œ</button>
          <button onclick="goHome()">ğŸ  í™ˆ</button>
        </div>
      `;
    }

    function selectExamAnswer(i) {
      answers[currentQuestion] = i;
      displayExamQuestion();
    }

    function startTimer() {
      const timerDiv = document.getElementById("timerDiv");
      timer = setInterval(() => {
        timeLeft--;
        if (timeLeft <= 0) {
          clearInterval(timer);
          submitExam();
        } else {
          const el = document.getElementById("timerDiv");
          if (el) el.textContent = `â° ë‚¨ì€ ì‹œê°„: ${formatTime(timeLeft)}`;
        }
      }, 1000);
    }

    function formatTime(sec) {
      const m = Math.floor(sec / 60);
      const s = sec % 60;
      return `${m}ë¶„ ${s}ì´ˆ`;
    }

    function prevQuestion() {
      if (currentQuestion > 0) {
        currentQuestion--;
        mode === "practice" ? displayPracticeQuestion() : displayExamQuestion();
      }
    }

    function nextQuestion() {
      if (currentQuestion < questions.length - 1) {
        currentQuestion++;
        mode === "practice" ? displayPracticeQuestion() : displayExamQuestion();
      }
    }

    function submitExam() {
      clearInterval(timer);
      let correct = 0;
      questions.forEach((q, i) => {
        const selected = q.options[answers[i]];
        if (selected && selected.includes(q.answer)) correct++;
      });
      const app = document.getElementById("app");
      app.innerHTML = `
        <h2>ğŸ“Š ëª¨ì˜ê³ ì‚¬ ê²°ê³¼</h2>
        <p>ì´ ${questions.length}ë¬¸ì œ ì¤‘ ${correct}ê°œ ì •ë‹µ</p>
        <button onclick="goHome()">ğŸ  í™ˆìœ¼ë¡œ</button>
      `;
    }

    function goHome() {
      clearInterval(timer);
      location.reload();
    }

    function shuffle(array) {
      return array.sort(() => Math.random() - 0.5);
    }
  </script>
</body>
</html>
