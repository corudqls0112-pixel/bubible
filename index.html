<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>백석대 졸업고사 대비</title>
<style>
  body {
    font-family: 'Arial', sans-serif;
    background: #e6f0ff;
    margin: 0;
    padding: 20px;
    text-align: center;
  }
  h1 { color: #003399; font-size: 1.8em; }
  button {
    margin: 5px;
    padding: 10px 15px;
    border: none;
    border-radius: 10px;
    background-color: #3366cc;
    color: white;
    cursor: pointer;
  }
  button:hover { background-color: #264d99; }
  #container { max-width: 500px; margin: 0 auto; }
  .option-btn {
    display: block;
    width: 100%;
    margin: 5px 0;
    background: white;
    color: #003366;
    border: 1px solid #003366;
  }
  #timer { font-weight: bold; color: red; margin: 10px; }
  #result { margin-top: 15px; text-align: left; }
  @media (max-width: 600px) {
    body { padding: 10px; }
    button { width: 100%; }
  }
</style>
</head>
<body>
  <div id="home">
    <h1>📖 백석대 졸업고사</h1>
    <button onclick="startPractice()">연습문제</button>
    <button onclick="startExam()">모의고사</button>
  </div>

  <div id="rangeSelect" style="display:none;">
    <h2>📚 범위를 선택하세요</h2>
    <div id="rangeButtons"></div>
    <button onclick="goHome()">🏠 홈으로</button>
  </div>

  <div id="quiz" style="display:none;">
    <div id="timer"></div>
    <div id="question"></div>
    <div id="options"></div>
    <div id="result"></div>
    <button id="prevBtn" onclick="prevQuestion()">⬅ 이전 문제</button>
    <button id="nextBtn" onclick="nextQuestion()">➡ 다음 문제</button>
    <button onclick="submitExam()" id="submitBtn" style="display:none;">제출하기</button>
    <button onclick="goHome()">🏠 홈으로</button>
  </div>

  <script>
  let mode = "";
  let questions = [];
  let currentIndex = 0;
  let score = 0;
  let answers = [];
  let timer;
  const totalExamQuestions = 50;
  const examTime = 50 * 60; // 50분

  const rangeFiles = {
    "고린도전서": "1.txt",
    "고린도후서": "2.txt",
    "갈라디아서": "3.txt",
    "에베소서": "4.txt",
    "빌립보서": "5.txt",
    "골로새서": "6.txt",
    "데살로니가전서": "7.txt",
    "데살로니가후서": "8.txt",
    "디모데전서": "9.txt",
    "디모데후서": "10.txt",
    "디도서": "11.txt",
    "빌레몬서": "12.txt",
    "히브리서": "13.txt",
    "야고보서": "14.txt",
    "베드로전서": "15.txt",
    "베드로후서": "16.txt",
    "요한일서": "17.txt",
    "요한이서": "18.txt",
    "요한삼서": "19.txt",
    "유다서": "20.txt",
    "요한계시록": "21.txt"
  };

  function goHome(){
    document.getElementById("home").style.display = "block";
    document.getElementById("rangeSelect").style.display = "none";
    document.getElementById("quiz").style.display = "none";
    clearInterval(timer);
  }

  function startPractice(){
    mode = "practice";
    document.getElementById("home").style.display = "none";
    document.getElementById("rangeSelect").style.display = "block";
    const container = document.getElementById("rangeButtons");
    container.innerHTML = "";
    for (let name in rangeFiles) {
      const btn = document.createElement("button");
      btn.textContent = name;
      btn.onclick = ()=>loadQuestions(rangeFiles[name]);
      container.appendChild(btn);
    }
  }

  async function startExam(){
    mode = "exam";
    document.getElementById("home").style.display = "none";
    document.getElementById("quiz").style.display = "block";
    questions = [];
    const keys = Object.keys(rangeFiles);
    for (let key of keys){
      const res = await fetch(`questions/${rangeFiles[key]}`);
      if(res.ok){
        const text = await res.text();
        const allQs = parseQuestions(text);
        questions.push(...shuffle(allQs).slice(0,3)); // 각 범위에서 3문제씩
      }
    }
    questions = shuffle(questions).slice(0, totalExamQuestions);
    answers = new Array(questions.length).fill(null);
    currentIndex = 0;
    score = 0;
    showQuestion();
    document.getElementById("submitBtn").style.display = "block";
    startTimer(examTime);
  }

  async function loadQuestions(file){
    const res = await fetch(`questions/${file}`);
    const text = await res.text();
    questions = parseQuestions(text);
    // ✅ 수정: 10문제 제한 제거 → 모든 문제 표시
    answers = new Array(questions.length).fill(null);
    document.getElementById("rangeSelect").style.display = "none";
    document.getElementById("quiz").style.display = "block";
    document.getElementById("submitBtn").style.display = "none";
    currentIndex = 0;
    showQuestion();
  }

  function parseQuestions(text){
    const lines = text.split("\n").map(l=>l.trim()).filter(Boolean);
    const qs = [];
    let current = {};
    lines.forEach(line=>{
      if(line.startsWith("답:")){
        current.answer = parseInt(line.replace("답:","").trim())-1;
        qs.push(current);
        current = {};
      } else if(!current.question){
        current.question = line;
        current.options = [];
      } else {
        current.options.push(line.replace(/^\d번:\s*/,""));
      }
    });
    return qs;
  }

  function showQuestion(){
    const q = questions[currentIndex];
    document.getElementById("question").innerText = `(${currentIndex+1}/${questions.length}) ${q.question}`;
    const optionsDiv = document.getElementById("options");
    optionsDiv.innerHTML = "";
    q.options.forEach((opt,i)=>{
      const btn = document.createElement("button");
      btn.className = "option-btn";
      btn.innerText = opt;
      btn.onclick = ()=>selectAnswer(i);
      optionsDiv.appendChild(btn);
    });
    document.getElementById("result").innerText = "";
  }

  function selectAnswer(i){
    const q = questions[currentIndex];
    answers[currentIndex] = i;
    if(mode === "practice"){
      const resultDiv = document.getElementById("result");
      if(i === q.answer){
        resultDiv.innerHTML = "✅ 정답입니다!";
      } else {
        resultDiv.innerHTML = `❌ 오답입니다.<br>정답: ${q.options[q.answer]}`;
      }
    } else if(mode === "exam"){
      nextQuestion();
    }
  }

  function nextQuestion(){
    if(currentIndex < questions.length - 1){
      currentIndex++;
      showQuestion();
    }
  }

  function prevQuestion(){
    if(currentIndex > 0){
      currentIndex--;
      showQuestion();
    }
  }

  // --- 모의고사 결과 표시 확장 ---
function submitMockExam() {
  clearInterval(timerInterval);
  let correct = 0;
  const resultDiv = document.getElementById("result");
  resultDiv.innerHTML = `<h3>결과</h3>`;

  questions.forEach((q, i) => {
    const userAns = userAnswers[i];
    const isCorrect = userAns === q.answer;
    if (isCorrect) correct++;

    const userChoice = userAns !== null ? q.options[userAns] : "(무응답)";
    const correctChoice = q.options[q.answer];

    // 🔹 각 문항별 결과 표시
    const questionResult = document.createElement("div");
    questionResult.classList.add("question-result");
    questionResult.style.marginBottom = "12px";
    questionResult.style.padding = "8px";
    questionResult.style.border = "1px solid #ccc";
    questionResult.style.borderRadius = "8px";
    questionResult.style.backgroundColor = isCorrect ? "#e8ffe8" : "#ffe8e8";

    questionResult.innerHTML = `
      <strong>(${i + 1}) ${q.question}</strong><br>
      <span>내가 선택한 답: ${userChoice}</span><br>
      <span>정답: ${correctChoice}</span><br>
      <span style="font-weight:bold; color:${isCorrect ? 'green' : 'red'};">
        ${isCorrect ? '정답 ✅' : '오답 ❌'}
      </span>
    `;

    resultDiv.appendChild(questionResult);
  });

  // 🔹 총점 표시
  const totalScore = document.createElement("h4");
  totalScore.innerText = `총점: ${correct}/${questions.length}`;
  totalScore.style.textAlign = "center";
  totalScore.style.marginTop = "20px";
  resultDiv.prepend(totalScore);

  // 🔹 다시하기 버튼
  const retryBtn = document.createElement("button");
  retryBtn.innerText = "다시하기";
  retryBtn.onclick = () => location.reload();
  retryBtn.style.display = "block";
  retryBtn.style.margin = "20px auto";
  retryBtn.style.padding = "10px 20px";
  retryBtn.style.fontSize = "16px";
  retryBtn.style.borderRadius = "8px";
  retryBtn.style.backgroundColor = "#4CAF50";
  retryBtn.style.color = "white";
  resultDiv.appendChild(retryBtn);
}
  function startTimer(seconds){
    const timerDiv = document.getElementById("timer");
    let remaining = seconds;
    timer = setInterval(()=>{
      const min = Math.floor(remaining/60);
      const sec = remaining%60;
      timerDiv.textContent = `⏱ 남은 시간: ${min}:${sec.toString().padStart(2,"0")}`;
      if(remaining <= 0){
        clearInterval(timer);
        alert("시간 종료! 자동 제출됩니다.");
        submitExam();
      }
      remaining--;
    },1000);
  }
  </script>
</body>
</html>
