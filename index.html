<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ë°±ì„ëŒ€ ì„±ê²½ê³ ì‚¬</title>
<style>
body {
  font-family: 'Noto Sans KR', sans-serif;
  background-color: #e6f0ff;
  text-align: center;
  margin: 0;
  padding: 20px;
}
h1 {
  color: #002366;
  font-size: 2em;
  margin-bottom: 10px;
}
button {
  margin: 10px;
  padding: 12px 20px;
  font-size: 1em;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  background-color: #0056d6;
  color: white;
  transition: background 0.3s;
}
button:hover {
  background-color: #003c9d;
}
#question-container {
  margin-top: 20px;
  padding: 20px;
  background: white;
  border-radius: 15px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  display: none;
}
#home-btn { display: none; background-color: #007bff; }
.timer { font-size: 1.2em; color: #d9534f; font-weight: bold; }
#statistics { margin-top: 20px; font-size: 1em; }
</style>
</head>
<body>

<h1>ğŸ“– ë°±ì„ëŒ€ ì„±ê²½ê³ ì‚¬</h1>

<div id="home-screen">
  <button id="practice-btn">ì—°ìŠµë¬¸ì œ ì‹œì‘</button>
  <button id="mock-btn">ëª¨ì˜ê³ ì‚¬ ì‹œì‘</button>
</div>

<button id="home-btn">ğŸ  í™ˆìœ¼ë¡œ</button>

<div id="question-container">
  <div id="timer" class="timer"></div>
  <h2 id="question"></h2>
  <div id="options"></div>
  <button id="prev-btn" style="display:none;">â¬… ì´ì „ë¬¸ì œ</button>
  <button id="next-btn">ë‹¤ìŒë¬¸ì œ</button>
  <button id="submit-btn" style="display:none;">ì œì¶œí•˜ê¸°</button>
  <div id="result"></div>
</div>

<div id="statistics"></div>

<script>
let questions = [];
let currentIndex = 0;
let mode = '';
let answers = [];
let timer;
let timeLeft = 0;

document.getElementById("practice-btn").onclick = () => startMode("practice");
document.getElementById("mock-btn").onclick = () => startMode("mock");
document.getElementById("home-btn").onclick = goHome;
document.getElementById("next-btn").onclick = nextQuestion;
document.getElementById("prev-btn").onclick = prevQuestion;
document.getElementById("submit-btn").onclick = showMockResult;

function goHome() {
  document.getElementById("home-screen").style.display = "block";
  document.getElementById("home-btn").style.display = "none";
  document.getElementById("question-container").style.display = "none";
  clearInterval(timer);
  currentIndex = 0;
  answers = [];
  document.getElementById("statistics").innerHTML = "";
}

async function startMode(selectedMode) {
  mode = selectedMode;
  document.getElementById("home-screen").style.display = "none";
  document.getElementById("home-btn").style.display = "block";
  document.getElementById("question-container").style.display = "block";
  await loadQuestions();

  if(mode === "mock"){
    questions = shuffle(questions).slice(0,50);
    startTimer(3000); // 50ë¶„
    document.getElementById("prev-btn").style.display = "inline";
    document.getElementById("submit-btn").style.display = "inline";
  } else {
    document.getElementById("timer").innerText = "";
    document.getElementById("prev-btn").style.display = "none";
    document.getElementById("submit-btn").style.display = "none";
  }

  showQuestion();
}

async function loadQuestions() {
  const files = [1,2,3,4,5,6,7,8,9,10];
  const loaded = [];
  for(const num of files){
    try{
      const res = await fetch(`questions/${num}.txt`);
      if(res.ok){
        const text = await res.text();
        loaded.push(...parseQuestions(text));
      }
    } catch(e){ console.log(e);}
  }
  questions = loaded;
}

// ë¬¸ì œ íŒŒì‹±
function parseQuestions(text) {
  const lines = text.split("\n").map(l=>l.trim()).filter(Boolean);
  const qs = [];
  let current = {};
  lines.forEach(line=>{
    if(line.startsWith("ë‹µ:")){
      current.answer = parseInt(line.replace("ë‹µ:","").trim())-1;
      qs.push(current);
      current = {};
    } else if(!current.question){
      current.question = line;
      current.options = [];
    } else {
      current.options.push(line.replace(/^\dë²ˆ:\s*/,""));
    }
  });
  return qs;
}

function showQuestion(){
  const q = questions[currentIndex];
  document.getElementById("question").innerText = `(${currentIndex+1}) ${q.question}`;
  const optionsDiv = document.getElementById("options");
  optionsDiv.innerHTML = "";
  q.options.forEach((opt,i)=>{
    const btn = document.createElement("button");
    btn.innerText = opt;
    btn.onclick = ()=>selectAnswer(i);
    optionsDiv.appendChild(btn);
  });
  document.getElementById("result").innerText = "";

// ë²„íŠ¼ í‘œì‹œ
  if(mode==="practice"){
    document.getElementById("next-btn").style.display = "inline";
    document.getElementById("prev-btn").style.display = "none";
    document.getElementById("submit-btn").style.display = "none";
  } else {
    document.getElementById("next-btn").style.display = "inline";
    document.getElementById("prev-btn").style.display = currentIndex>0 ? "inline":"none";
    document.getElementById("submit-btn").style.display = "inline";
  }
}

function selectAnswer(i){
  const q = questions[currentIndex];
  if(mode==="practice"){
    if(i===q.answer){
      document.getElementById("result").innerText = "âœ… ì •ë‹µì…ë‹ˆë‹¤!";
    } else {
      document.getElementById("result").innerText = `âŒ ì˜¤ë‹µì…ë‹ˆë‹¤. ì •ë‹µ: ${q.options[q.answer]}`;
    }
  } else { // ëª¨ì˜ê³ ì‚¬
    answers[currentIndex] = i; // ë‹µ ì €ì¥
    document.getElementById("result").innerText = `ì„ íƒ: ${q.options[i]}`; // ì„ íƒ í‘œì‹œ
  }
}

// ë‹¤ìŒ ë²„íŠ¼ (ëª¨ì˜ê³ ì‚¬ì™€ ì—°ìŠµë¬¸ì œ ê³µìš©)
function nextQuestion(){
  if(currentIndex < questions.length-1){
    currentIndex++;
    showQuestion();
  }
}

// ì´ì „ ë²„íŠ¼ (ëª¨ì˜ê³ ì‚¬ ì „ìš©)
function prevQuestion(){
  if(currentIndex > 0){
    currentIndex--;
    showQuestion();
  }
}

// ì œì¶œ ë²„íŠ¼
function showMockResult(){
  clearInterval(timer);
  let score = 0;
  let resultText = `<h3>ê²°ê³¼</h3>`;
  questions.forEach((q,i)=>{
    const user = answers[i];
    if(user === q.answer){
      score++;
      resultText += `<p>${i+1}ë²ˆ âœ… ì •ë‹µ - ì„ íƒ: ${q.options[user]}</p>`;
    } else {
      resultText += `<p>${i+1}ë²ˆ âŒ ì˜¤ë‹µ - ì„ íƒ: ${user!==undefined?q.options[user]:"-"}, ì •ë‹µ: ${q.options[q.answer]}</p>`;
    }
  });
  document.getElementById("question").innerHTML = `<h2>ì´ì : ${Math.round(score/questions.length*100)}ì  (${score}/${questions.length})</h2>`+resultText;
  document.getElementById("options").innerHTML = "";
  document.getElementById("next-btn").style.display = "none";
  document.getElementById("prev-btn").style.display = "none";
  document.getElementById("submit-btn").style.display = "none";
  document.getElementById("timer").innerText = "";
  document.getElementById("statistics").innerText = `í†µê³„: ì´ ${questions.length}ë¬¸ì œ ì¤‘ ${score}ì `;
}

function startTimer(seconds){
  timeLeft = seconds;
  timer = setInterval(()=>{
    const min = Math.floor(timeLeft/60);
    const sec = timeLeft%60;
    document.getElementById("timer").innerText = `â° ë‚¨ì€ ì‹œê°„: ${min}ë¶„ ${sec<10?"0"+sec:sec}ì´ˆ`;
    if(timeLeft--<=0){
      clearInterval(timer);
      showMockResult();
    }
  },1000);
}

function shuffle(arr){ return arr.sort(()=>Math.random()-0.5); }

</script>
</body>
</html>
