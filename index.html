<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì„±ê²½ê³ ì‚¬ ì•±</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Pretendard', sans-serif;
      background: #f9fafb;
      color: #333;
      margin: 0;
      padding: 0;
    }
    header {
      background: #2563eb;
      color: white;
      text-align: center;
      padding: 1rem;
      font-size: 1.5rem;
      font-weight: bold;
    }
    nav {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      background: #1e3a8a;
      padding: 0.5rem;
    }
    nav button {
      background: #3b82f6;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 5px;
      cursor: pointer;
    }
    nav button:hover {
      background: #60a5fa;
    }
    .container {
      max-width: 800px;
      margin: 1.5rem auto;
      background: white;
      padding: 1rem 1.5rem;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .question { margin-bottom: 1rem; }
    .option {
      margin: 0.25rem 0;
      padding: 0.5rem;
      border: 1px solid #ddd;
      border-radius: 5px;
      cursor: pointer;
    }
    .option:hover { background: #f0f9ff; }
    .correct { background: #bbf7d0; }
    .wrong { background: #fecaca; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    th, td {
      border: 1px solid #ddd;
      text-align: center;
      padding: 0.5rem;
    }
    th {
      background: #f1f5f9;
    }
    .hidden { display: none; }
    .btn {
      margin-top: 1rem;
      padding: 0.6rem 1rem;
      background: #2563eb;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .btn:hover { background: #1d4ed8; }
  </style>
</head>
<body>
  <header>ğŸ“– ì„±ê²½ê³ ì‚¬ ì•±</header>

  <nav>
    <button onclick="showPage('practice')">ì—°ìŠµë¬¸ì œ</button>
    <button onclick="showPage('mock')">ëª¨ì˜ê³ ì‚¬</button>
    <button onclick="showPage('manage')">ë¬¸ì œ ê´€ë¦¬</button>
    <button onclick="showPage('stats')">í†µê³„</button>
  </nav>

  <div class="container" id="content"></div>

  <script>
    const STORAGE_KEY = 'bibleQuestions';
    const RESULT_KEY = 'examResults';
    const QUESTION_URL = 'questions.json'; // âœ… GitHubì—ì„œ ì§ì ‘ ê´€ë¦¬í•  JSON íŒŒì¼

    async function loadQuestions() {
      // 1ï¸âƒ£ GitHub pagesì—ì„œ questions.jsonì„ ë¶ˆëŸ¬ì˜¤ê¸° ì‹œë„
      try {
        const res = await fetch(QUESTION_URL);
        if (res.ok) {
          const data = await res.json();
          localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
          return data;
        }
      } catch (e) {
        console.warn("questions.json ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨, ë¡œì»¬ ë°ì´í„° ì‚¬ìš©");
      }

      // 2ï¸âƒ£ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ë°±ì—…
      return JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
    }

    function saveQuestions(qs) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(qs));
    }

    function showPage(page) {
      const container = document.getElementById('content');
      container.innerHTML = '';

      if (page === 'practice') renderPractice();
      else if (page === 'mock') renderMock();
      else if (page === 'manage') renderManage();
      else if (page === 'stats') renderStats();
    }

    // âœ… ì—°ìŠµë¬¸ì œ
    async function renderPractice() {
      const container = document.getElementById('content');
      const questions = await loadQuestions();
      if (!questions.length) return container.innerHTML = "<p>ë¬¸ì œë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”.</p>";

      container.innerHTML = '<h2>ğŸ“ ì—°ìŠµë¬¸ì œ</h2>';
      questions.forEach((q, idx) => {
        const div = document.createElement('div');
        div.className = 'question';
        div.innerHTML = `<p><b>${idx + 1}. ${q.q}</b></p>`;
        q.options.forEach((opt, i) => {
          const btn = document.createElement('div');
          btn.className = 'option';
          btn.textContent = opt;
          btn.onclick = () => {
            if (i === q.answer) btn.classList.add('correct');
            else btn.classList.add('wrong');
          };
          div.appendChild(btn);
        });
        container.appendChild(div);
      });
    }

    // âœ… ëª¨ì˜ê³ ì‚¬ (ëœë¤ ë¬¸ì œ)
    async function renderMock() {
      const container = document.getElementById('content');
      let questions = await loadQuestions();
      if (!questions.length) return container.innerHTML = "<p>ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.</p>";

      // ğŸ”€ ë¬¸ì œ ìˆœì„œ ëœë¤í™”
      questions = questions.sort(() => Math.random() - 0.5);
      let score = 0, current = 0;

      const renderQuestion = () => {
        container.innerHTML = `<h2>ğŸ“š ëª¨ì˜ê³ ì‚¬ (${current + 1}/${questions.length})</h2>`;
        const q = questions[current];
        const div = document.createElement('div');
        div.innerHTML = `<p><b>${q.q}</b></p>`;
        q.options.forEach((opt, i) => {
          const btn = document.createElement('div');
          btn.className = 'option';
          btn.textContent = opt;
          btn.onclick = () => {
            if (i === q.answer) score++;
            current++;
            if (current < questions.length) renderQuestion();
            else showResult();
          };
          div.appendChild(btn);
        });
        container.appendChild(div);
      };

      const showResult = () => {
        const percent = (score / questions.length * 100).toFixed(1);
        container.innerHTML = `<h2>ê²°ê³¼: ${score}/${questions.length}</h2>
          <p>ì ìˆ˜: ${percent}%</p>
          <button class="btn" onclick="showPage('stats')">í†µê³„ ë³´ê¸°</button>`;
        saveResult(score, questions.length);
      };

      renderQuestion();
    }

    // âœ… ë¬¸ì œ ê´€ë¦¬
    async function renderManage() {
      const container = document.getElementById('content');
      const questions = await loadQuestions();
      container.innerHTML = `
        <h2>âš™ ë¬¸ì œ ê´€ë¦¬</h2>
        <div>
          <input id="qText" placeholder="ë¬¸ì œ" style="width:100%;padding:0.5rem;margin-bottom:0.5rem;">
          <input id="opt1" placeholder="ë³´ê¸° 1" style="width:48%;margin-right:2%;">
          <input id="opt2" placeholder="ë³´ê¸° 2" style="width:48%;">
          <input id="opt3" placeholder="ë³´ê¸° 3" style="width:48%;margin-right:2%;">
          <input id="opt4" placeholder="ë³´ê¸° 4" style="width:48%;">
          <input id="ans" type="number" min="1" max="4" placeholder="ì •ë‹µ ë²ˆí˜¸(1~4)" style="width:100%;margin-top:0.5rem;">
          <button class="btn" onclick="addQuestion()">ë¬¸ì œ ì¶”ê°€</button>
        </div>
        <hr>
        <h3>í˜„ì¬ ë“±ë¡ëœ ë¬¸ì œ (${questions.length}ê°œ)</h3>
        <ul>${questions.map((q,i)=>`<li>${i+1}. ${q.q}</li>`).join('')}</ul>
        <p style="color:gray;font-size:0.9rem;">â€» GitHubì— ì˜¬ë¦° questions.json íŒŒì¼ë„ ìˆ˜ì • ê°€ëŠ¥</p>
      `;
    }

    function addQuestion() {
      const q = document.getElementById('qText').value;
      const opts = [opt1.value, opt2.value, opt3.value, opt4.value];
      const ans = parseInt(document.getElementById('ans').value) - 1;
      if (!q || opts.some(o=>!o) || isNaN(ans)) return alert("ëª¨ë“  ì¹¸ì„ ì±„ì›Œì£¼ì„¸ìš”!");

      const qs = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
      qs.push({ q, options: opts, answer: ans });
      saveQuestions(qs);
      alert("ë¬¸ì œê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!");
      showPage('manage');
    }

    // âœ… í†µê³„ (ì°¨íŠ¸ í¬í•¨)
    function renderStats() {
      const records = JSON.parse(localStorage.getItem(RESULT_KEY) || '[]');
      const container = document.getElementById('content');
      container.innerHTML = '<h2>ğŸ“Š í†µê³„</h2>';

      if (records.length === 0) {
        container.innerHTML += '<p>ì•„ì§ ì‹œí—˜ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
        return;
      }

      const avg = (records.reduce((a,b)=>a+b.percentage,0)/records.length).toFixed(1);
      container.innerHTML += `<p>í‰ê·  ì ìˆ˜: <b>${avg}%</b></p><canvas id="scoreChart"></canvas>`;

      const lastFive = records.slice(-5);
      const ctx = document.getElementById('scoreChart').getContext('2d');
      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: lastFive.map(r => new Date(r.date).toLocaleDateString()),
          datasets: [{
            label: 'ìµœê·¼ ì ìˆ˜',
            data: lastFive.map(r => r.percentage),
            backgroundColor: '#60a5fa'
          }]
        },
        options: { scales: { y: { beginAtZero: true, max: 100 } } }
      });
    }

    function saveResult(score, total) {
      const record = {
        date: new Date().toISOString(),
        score,
        total,
        percentage: Math.round((score/total)*100)
      };
      const existing = JSON.parse(localStorage.getItem(RESULT_KEY) || '[]');
      localStorage.setItem(RESULT_KEY, JSON.stringify([...existing, record]));
    }

    showPage('practice');
  </script>
</body>
</html>
