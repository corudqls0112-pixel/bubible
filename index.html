<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>📘 백석대 졸업고사</title>
  <style>
    body {
      font-family: "Noto Sans KR", sans-serif;
      background-color: #004a99; /* 백석대 파란색 */
      color: #fff;
      text-align: center;
      margin: 0;
      padding: 30px;
    }
    #app {
      background: white;
      color: black;
      max-width: 700px;
      margin: 0 auto;
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 0 20px rgba(0,0,0,0.3);
    }
    button {
      background: #004a99;
      color: white;
      border: none;
      padding: 10px 18px;
      border-radius: 10px;
      cursor: pointer;
      margin: 5px;
      transition: 0.2s;
    }
    button:hover {
      background: #0066cc;
    }
    .answer {
      margin-top: 15px;
      background: #f0f8ff;
      padding: 15px;
      border-radius: 10px;
    }
  </style>
</head>
<body>
  <div id="app">
    <h1>📖 백석대 졸업고사</h1>
    <p>원하는 모드를 선택하세요</p>
    <button onclick="startMode('practice')">연습문제</button>
    <button onclick="startMode('exam')">모의고사</button>
  </div>

  <script>
    let questions = [];
    let currentQuestion = 0;
    let answers = [];
    let timer;
    let timeLeft = 0;
    let mode = ""; // 'practice' or 'exam'
    const totalExamTime = 50 * 60; // 50분

    async function startMode(selectedMode) {
      mode = selectedMode;
      document.getElementById("app").innerHTML = "<h2>문제 불러오는 중...</h2>";
      await loadQuestions();
      if (mode === "practice") startPracticeMode();
      else startExamMode();
    }

    async function loadQuestions() {
      const files = [1]; // 예시로 1.txt만 사용
      let loaded = [];
      for (const num of files) {
        try {
          const res = await fetch(`questions/${num}.txt`);
          if (res.ok) {
            const text = await res.text();
            loaded = loaded.concat(parseQuestions(text));
          }
        } catch (err) {
          console.error(err);
        }
      }
      // 문제 단위로 랜덤
      questions = shuffle(loaded);
    }

    function parseQuestions(text) {
      const blocks = text.split(/\n(?=\d+\.)/);
      return blocks.map(block => {
        const lines = block.trim().split('\n').filter(Boolean);
        const question = lines[0];
        const options = lines.slice(1, 5);
        const answerLine = lines.find(l => l.startsWith("정답:"));
        const explanationLine = lines.find(l => l.startsWith("해설:"));
        const answer = answerLine ? answerLine.replace("정답:", "").trim() : "";
        const explanation = explanationLine ? explanationLine.replace("해설:", "").trim() : "";
        return { question, options, answer, explanation };
      }).filter(q => q.question && q.options.length);
    }

    function startPracticeMode() {
      currentQuestion = 0;
      answers = [];
      displayPracticeQuestion();
    }

    function startExamMode() {
      currentQuestion = 0;
      answers = [];
      timeLeft = totalExamTime;
      questions = shuffle(questions).slice(0, 50); // 50문제만 랜덤
      displayExamQuestion();
      startTimer();
    }

    function displayPracticeQuestion() {
      const q = questions[currentQuestion];
      const app = document.getElementById("app");
      app.innerHTML = `
        <h2>연습문제 ${currentQuestion + 1}/${questions.length}</h2>
        <p>${q.question}</p>
        ${q.options.map((opt, i) => 
          `<button onclick="checkPracticeAnswer(${i})">${opt}</button>`
        ).join("")}
        <div>
          <button onclick="prevQuestion()">이전</button>
          <button onclick="nextQuestion()">다음</button>
          <button onclick="goHome()">🏠 홈</button>
        </div>
      `;
    }

    function checkPracticeAnswer(selectedIndex) {
      const q = questions[currentQuestion];
      const selected = q.options[selectedIndex];
      const isCorrect = selected.includes(q.answer);
      const app = document.getElementById("app");
      app.innerHTML += `
        <div class="answer">
          <p>${isCorrect ? "✅ 정답입니다!" : "❌ 오답입니다!"}</p>
          <p><b>정답:</b> ${q.answer}</p>
          ${q.explanation ? `<p><b>해설:</b> ${q.explanation}</p>` : ""}
        </div>
      `;
    }

    function displayExamQuestion() {
      const q = questions[currentQuestion];
      const app = document.getElementById("app");
      app.innerHTML = `
        <h2>모의고사 ${currentQuestion + 1}/${questions.length}</h2>
        <div id="timerDiv">⏰ 남은 시간: ${formatTime(timeLeft)}</div>
        <p>${q.question}</p>
        ${q.options.map((opt, i) => 
          `<button onclick="selectExamAnswer(${i})"
           style="${answers[currentQuestion]===i ? 'background:#004a99;' : ''}">
           ${opt}</button>`
        ).join("")}
        <div>
          <button onclick="prevQuestion()">이전</button>
          <button onclick="nextQuestion()">다음</button>
          <button onclick="submitExam()">제출</button>
          <button onclick="goHome()">🏠 홈</button>
        </div>
      `;
    }

    function selectExamAnswer(i) {
      answers[currentQuestion] = i;
      displayExamQuestion();
    }

    function startTimer() {
      const timerDiv = document.getElementById("timerDiv");
      timer = setInterval(() => {
        timeLeft--;
        if (timeLeft <= 0) {
          clearInterval(timer);
          submitExam();
        } else {
          const el = document.getElementById("timerDiv");
          if (el) el.textContent = `⏰ 남은 시간: ${formatTime(timeLeft)}`;
        }
      }, 1000);
    }

    function formatTime(sec) {
      const m = Math.floor(sec / 60);
      const s = sec % 60;
      return `${m}분 ${s}초`;
    }

    function prevQuestion() {
      if (currentQuestion > 0) {
        currentQuestion--;
        mode === "practice" ? displayPracticeQuestion() : displayExamQuestion();
      }
    }

    function nextQuestion() {
      if (currentQuestion < questions.length - 1) {
        currentQuestion++;
        mode === "practice" ? displayPracticeQuestion() : displayExamQuestion();
      }
    }

    function submitExam() {
      clearInterval(timer);
      let correct = 0;
      questions.forEach((q, i) => {
        const selected = q.options[answers[i]];
        if (selected && selected.includes(q.answer)) correct++;
      });
      const app = document.getElementById("app");
      app.innerHTML = `
        <h2>📊 모의고사 결과</h2>
        <p>총 ${questions.length}문제 중 ${correct}개 정답</p>
        <button onclick="goHome()">🏠 홈으로</button>
      `;
    }

    function goHome() {
      clearInterval(timer);
      location.reload();
    }

    function shuffle(array) {
      return array.sort(() => Math.random() - 0.5);
    }
  </script>
</body>
</html>
