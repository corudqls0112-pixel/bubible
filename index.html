<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë°±ì„ëŒ€ ì„±ê²½ê³ ì‚¬</title>
<style>
body {
  font-family: 'Noto Sans KR', sans-serif;
  background-color: #e6f0ff;
  text-align: center;
  margin: 0;
  padding: 10px;
}
h1 { color: #002366; font-size: 2em; margin-bottom: 10px; }
button {
  margin: 5px;
  padding: 10px 15px;
  font-size: 1em;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  background-color: #0056d6;
  color: white;
}
button:hover { background-color: #003c9d; }
#question-container {
  margin-top: 20px;
  padding: 15px;
  background: white;
  border-radius: 10px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  display: none;
}
.timer { font-size: 1.2em; color: #d9534f; font-weight: bold; }
@media(max-width:600px){
  button { font-size: 0.9em; padding: 8px 10px; }
}
</style>
</head>
<body>
<h1>ğŸ“– ë°±ì„ëŒ€ ì„±ê²½ê³ ì‚¬</h1>

<div id="home-screen">
  <button id="practice-btn">ì—°ìŠµë¬¸ì œ ì‹œì‘</button>
  <button id="mock-btn">ëª¨ì˜ê³ ì‚¬ ì‹œì‘</button>
</div>

<div id="range-selection" style="display:none;">
  <h2>ë²”ìœ„ë¥¼ ì„ íƒí•˜ì„¸ìš”</h2>
  <div id="range-buttons"></div>
  <button id="range-back">â¬… ëŒì•„ê°€ê¸°</button>
</div>

<button id="home-btn" style="display:none;">ğŸ  í™ˆìœ¼ë¡œ</button>

<div id="question-container">
  <div class="timer" id="timer"></div>
  <h2 id="question"></h2>
  <div id="options"></div>
  <button id="prev-btn" style="display:none;">â¬… ì´ì „ë¬¸ì œ</button>
  <button id="next-btn">ë‹¤ìŒë¬¸ì œ â¡</button>
  <button id="submit-btn" style="display:none;">ì œì¶œí•˜ê¸°</button>
  <div id="result"></div>
</div>

<script>
const ranges = ["ê³ ë¦°ë„ì „ì„œ","ê³ ë¦°ë„í›„ì„œ","ê°ˆë¼ë””ì•„ì„œ","ì—ë² ì†Œì„œ","ë¹Œë¦½ë³´ì„œ","ê³¨ë¡œìƒˆì„œ",
"ë°ì‚´ë¡œë‹ˆê°€ì „ì„œ","ë°ì‚´ë¡œë‹ˆê°€í›„ì„œ","ë””ëª¨ë°ì „ì„œ","ë””ëª¨ë°í›„ì„œ","ë””ë„ì„œ","ë¹Œë ˆëª¬ì„œ",
"íˆë¸Œë¦¬ì„œ","ì•¼ê³ ë³´ì„œ","ë² ë“œë¡œì „ì„œ","ë² ë“œë¡œí›„ì„œ","ìš”í•œì¼ì„œ","ìš”í•œì´ì„œ","ìš”í•œì‚¼ì„œ",
"ìœ ë‹¤ì„œ","ìš”í•œê³„ì‹œë¡"];

let questions = [], currentIndex=0, mode="", score=0, answers=[], timer, timeLeft=0;

document.getElementById("practice-btn").onclick = ()=>showRangeSelection("practice");
document.getElementById("mock-btn").onclick = ()=>startMode("mock");
document.getElementById("home-btn").onclick = goHome;
document.getElementById("next-btn").onclick = nextQuestion;
document.getElementById("prev-btn").onclick = prevQuestion;
document.getElementById("submit-btn").onclick = showMockResult;
document.getElementById("range-back").onclick = ()=>{document.getElementById("range-selection").style.display="none";document.getElementById("home-screen").style.display="block";};

function showRangeSelection(selectedMode){
  mode = selectedMode;
  document.getElementById("home-screen").style.display="none";
  document.getElementById("range-selection").style.display="block";
  const container = document.getElementById("range-buttons");
  container.innerHTML="";
  ranges.forEach(range=>{
    const btn = document.createElement("button");
    btn.innerText = range;
    btn.onclick = ()=>startPracticeRange(range);
    container.appendChild(btn);
  });
}

async function startPracticeRange(range){
  document.getElementById("range-selection").style.display="none";
  document.getElementById("home-btn").style.display="block";
  document.getElementById("question-container").style.display="block";
  await loadQuestions([range]);
  showQuestion();
}

async function startMode(selectedMode){
  mode = selectedMode;
  document.getElementById("home-screen").style.display="none";
  document.getElementById("home-btn").style.display="block";
  document.getElementById("question-container").style.display="block";
  if(mode==="mock"){
    await loadQuestions(ranges);
    questions = getMockQuestions(questions,50);
    startTimer(3000); // 50ë¶„
    document.getElementById("prev-btn").style.display="inline";
    document.getElementById("submit-btn").style.display="inline";
  }
  showQuestion();
}

async function loadQuestions(rangeList){
  let loaded=[];
  for(const r of rangeList){
    try{
      const res = await fetch(`questions/${r}.txt`);
      if(res.ok){
        const txt = await res.text();
        loaded.push(...parseQuestions(txt));
      }
    }catch(e){console.log(e);}
  }
  questions=loaded;
}

function parseQuestions(text){
  const lines = text.split("\n").map(l=>l.trim()).filter(Boolean);
  const qs=[];
  let current={};
  lines.forEach(line=>{
    if(line.startsWith("ë‹µ:")){
      current.answer = parseInt(line.replace("ë‹µ:","").trim())-1;
      qs.push(current);
      current={};
    } else if(!current.question){
      current.question = line;
      current.options=[];
    } else {
      current.options.push(line.replace(/^\dë²ˆ:\s*/,""));
    }
  });
  return qs;
}

function getMockQuestions(allQuestions,total){
  const mock=[];
  const perRange = Math.ceil(total/ranges.length);
  ranges.forEach(range=>{
    const rangeQs = allQuestions.filter(q=>q.range===range);
    shuffle(rangeQs);
    mock.push(...rangeQs.slice(0,perRange));
  });
  shuffle(mock);
  return mock.slice(0,total);
}

function showQuestion(){
  if(currentIndex>=questions.length) return;
  const q = questions[currentIndex];
  document.getElementById("question").innerText=`(${currentIndex+1}) ${q.question}`;
  const optionsDiv = document.getElementById("options");
  optionsDiv.innerHTML="";
  q.options.forEach((opt,i)=>{
    const btn = document.createElement("button");
    btn.innerText=opt;
    btn.onclick=()=>selectAnswer(i);
    optionsDiv.appendChild(btn);
  });
  document.getElementById("result").innerText="";
}

function selectAnswer(i){
  const q = questions[currentIndex];
  if(mode==="practice"){
    if(i===q.answer){
      document.getElementById("result").innerHTML=`âœ… ì •ë‹µì…ë‹ˆë‹¤!<br>ì •ë‹µ: ${q.options[q.answer]}`;
    }else{
      document.getElementById("result").innerHTML=`âŒ ì˜¤ë‹µì…ë‹ˆë‹¤.<br>ì •ë‹µ: ${q.options[q.answer]}`;
    }
  } else { // mock
    answers[currentIndex]=i;
    nextQuestion();
  }
}

function nextQuestion(){
  if(currentIndex<questions.length-1){
    currentIndex++;
    showQuestion();
  }
}
function prevQuestion(){
  if(currentIndex>0){
    currentIndex--;
    showQuestion();
  }
}

function showMockResult(){
  clearInterval(timer);
  let resultHTML=`<h2>ê²°ê³¼</h2>`;
  let score=0;
  questions.forEach((q,i)=>{
    const correct=q.answer;
    const selected=answers[i];
    if(selected===correct) score++;
    resultHTML+=`<p>${i+1}ë²ˆ - ì„ íƒ: ${selected!==undefined?q.options[selected]:"ë¯¸ì‘ë‹µ"}, ì •ë‹µ: ${q.options[correct]} ${selected===correct?"âœ…":"âŒ"}</p>`;
  });
  resultHTML=`<h3>ì´ì : ${Math.round(score/questions.length*100)}ì </h3>`+resultHTML;
  document.getElementById("question").innerHTML=resultHTML;
  document.getElementById("options").innerHTML="";
  document.getElementById("next-btn").style.display="none";
  document.getElementById("prev-btn").style.display="none";
  document.getElementById("submit-btn").style.display="none";
  document.getElementById("timer").innerText="";
}

function startTimer(sec){
  timeLeft=sec;
  timer=setInterval(()=>{
    const min=Math.floor(timeLeft/60);
    const s=timeLeft%60;
    document.getElementById("timer").innerText=`â° ë‚¨ì€ ì‹œê°„: ${min}ë¶„ ${s<10?"0"+s:s}ì´ˆ`;
    if(timeLeft--<=0){
      clearInterval(timer);
      showMockResult();
    }
  },1000);
}

function goHome(){
  document.getElementById("home-screen").style.display="block";
  document.getElementById("range-selection").style.display="none";
  document.getElementById("home-btn").style.display="none";
  document.getElementById("question-container").style.display="none";
  clearInterval(timer);
  currentIndex=0;
  answers=[];
  score=0;
}

function shuffle(arr){return arr.sort(()=>Math.random()-0.5);}
</script>
</body>
</html>
